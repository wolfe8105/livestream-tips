<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="theme-color" content="#ff1744">
  <title>LiveStream Tips</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #000;
      color: #fff;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -webkit-tap-highlight-color: transparent;
    }

    /* ===== LAYOUT ===== */
    .top-header {
      position: sticky; top: 0;
      background: linear-gradient(135deg, #ff1744, #c62828);
      border-bottom: 2px solid #ffc107;
      padding: 12px 16px;
      display: flex; justify-content: space-between; align-items: center;
      z-index: 100;
      box-shadow: 0 4px 16px rgba(255, 23, 68, 0.5);
    }
    .brand { font-size: 20px; font-weight: 900; color: #fff; }
    .token-badge {
      background: rgba(0,0,0,0.3); border: 2px solid #ffc107;
      padding: 8px 16px; border-radius: 12px;
      font-weight: 900; font-size: 15px; color: #ffc107;
    }
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: linear-gradient(to top, #1a0a0a, #120808);
      border-top: 2px solid #ff1744;
      display: flex; z-index: 100;
    }
    .nav-item {
      flex: 1; padding: 10px 0; text-align: center;
      background: none; border: none; color: #666;
      font-size: 11px; font-weight: 700; cursor: pointer;
    }
    .nav-item.active { color: #ff1744; }
    .nav-item-icon { font-size: 22px; margin-bottom: 2px; }
    .page { display: none; padding-bottom: 70px; }
    .page.active { display: block; }
    .page-pad { padding: 20px 16px; }

    /* ===== UTILITY CLASSES ===== */
    .flex-between { display: flex; justify-content: space-between; align-items: center; }
    .flex-center { display: flex; align-items: center; justify-content: center; }
    .flex-col-center { display: flex; flex-direction: column; align-items: center; }
    .flex-gap { display: flex; align-items: center; gap: 8px; }
    .flex-gap-lg { display: flex; align-items: center; gap: 16px; }
    .flex-col-gap { display: flex; flex-direction: column; gap: 6px; }
    .grid-2col { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .mb-4 { margin-bottom: 4px; }
    .mb-8 { margin-bottom: 8px; }
    .mb-12 { margin-bottom: 12px; }
    .mb-16 { margin-bottom: 16px; }
    .mb-20 { margin-bottom: 20px; }
    .mb-24 { margin-bottom: 24px; }
    .mt-12 { margin-top: 12px; }
    .mt-16 { margin-top: 16px; }
    .mt-20 { margin-top: 20px; }
    .text-center { text-align: center; }
    .w-full { width: 100%; }

    /* ===== TEXT STYLES ===== */
    .text-muted { color: #ff8a80; }
    .text-dim { color: #666; }
    .text-gold { color: #ffc107; }
    .text-red { color: #ff1744; }
    .text-pink { color: #ff4da6; }
    .text-white { color: #fff; }
    .text-xs { font-size: 11px; }
    .text-sm { font-size: 12px; }
    .text-md { font-size: 13px; }
    .text-base { font-size: 14px; }
    .text-lg { font-size: 16px; }
    .text-xl { font-size: 18px; }
    .text-2xl { font-size: 20px; }
    .text-3xl { font-size: 24px; }
    .text-4xl { font-size: 28px; }
    .text-5xl { font-size: 36px; }
    .text-6xl { font-size: 48px; }
    .text-giant { font-size: 56px; }
    .font-bold { font-weight: 700; }
    .font-black { font-weight: 900; }
    .leading-relaxed { line-height: 1.6; }
    .leading-loose { line-height: 1.8; }
    .hint { color: #666; font-size: 11px; margin-top: 4px; }

    /* ===== CARDS ===== */
    .card { border-radius: 12px; padding: 20px; }
    .card-dark { background: #1a0a0a; }
    .card-red { background: #1a0a0a; border: 2px solid #ff1744; }
    .card-gold { background: rgba(255,193,7,0.1); border: 2px solid #ffc107; }
    .card-pink { background: rgba(255,77,166,0.1); border: 1px solid #ff4da6; border-radius: 8px; padding: 12px; }
    .card-pink-dashed { background: rgba(255,77,166,0.1); border: 2px dashed #ff4da6; }
    .card-border { border: 2px solid #2a2020; }
    .card-premium {
      background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(155,89,182,0.15));
      border: 3px solid #ffc107; border-radius: 16px; padding: 24px;
      box-shadow: 0 8px 24px rgba(255, 193, 7, 0.3);
    }
    .card-spy {
      background: linear-gradient(135deg, rgba(155,89,182,0.15), rgba(255,77,166,0.15));
      border: 2px solid #ff4da6; border-radius: 16px; padding: 20px;
      box-shadow: 0 6px 20px rgba(255, 77, 166, 0.2);
    }
    .card-stat {
      background: rgba(0,0,0,0.4); padding: 16px; border-radius: 12px;
      text-align: center; border: 2px solid #ffc107;
    }
    .card-included {
      background: rgba(0,0,0,0.4); padding: 18px; border-radius: 12px;
      border: 1px solid #2a2020;
    }
    .section-divider { border-top: 1px solid #2a2020; padding-top: 20px; margin-top: 20px; }
    .section-border-bottom { margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid #2a2020; }

    /* ===== FORM ELEMENTS ===== */
    .form-group { margin-bottom: 12px; }
    .form-group-lg { margin-bottom: 20px; }
    .form-label { display: block; color: #ff8a80; font-size: 12px; margin-bottom: 6px; }
    .form-label-sm { display: block; color: #ff8a80; font-size: 11px; margin-bottom: 4px; }
    .form-label-md { display: block; color: #ff8a80; font-size: 13px; margin-bottom: 8px; }
    .form-input {
      width: 100%; background: #000; border: 1px solid #ff1744;
      border-radius: 6px; padding: 10px; color: #fff; font-size: 14px;
      outline: none;
    }
    .form-input-pink { border-color: #ff4da6; padding: 8px; }
    .form-input-gold {
      border: 2px solid #ffc107; border-radius: 8px;
      padding: 12px; font-size: 16px; font-weight: 700;
    }
    .form-input-lg { padding: 10px; font-size: 16px; }
    .form-select {
      width: 100%; background: #000; border: 1px solid #ff4da6;
      border-radius: 6px; padding: 10px; color: #fff; font-size: 16px;
    }

    /* ===== BUTTONS ===== */
    .btn {
      border: none; cursor: pointer; font-weight: 900;
      border-radius: 12px; text-align: center;
    }
    .btn:active { transform: scale(0.95); }
    .btn-primary {
      width: 100%; background: linear-gradient(135deg, #ffc107, #ff8c00);
      color: #000; padding: 20px; font-size: 18px; font-weight: 900;
      border: none; border-radius: 12px; cursor: pointer;
      box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4);
    }
    .btn-primary:active { transform: scale(0.95); }
    .btn-save {
      width: 100%; background: linear-gradient(135deg, #ff1744, #ff6b35);
      border: 2px solid #ffc107; color: white; padding: 16px;
      border-radius: 12px; font-size: 16px; font-weight: 900; cursor: pointer;
    }
    .btn-save:active { transform: scale(0.95); }
    .btn-pink {
      background: linear-gradient(135deg, #ff4da6, #c9377f);
      color: white; border: 2px solid #ffc107; padding: 12px;
      border-radius: 8px; font-size: 14px; font-weight: 900; cursor: pointer;
    }
    .btn-pink-lg {
      width: 100%; background: linear-gradient(135deg, #ff4da6, #c9377f);
      color: white; border: 2px solid #ffc107; padding: 18px;
      border-radius: 12px; font-weight: 900; font-size: 16px; cursor: pointer;
    }
    .btn-pink-lg:active, .btn-pink:active { transform: scale(0.95); }
    .btn-add-online {
      width: 100%; background: rgba(255, 193, 7, 0.1);
      border: 2px dashed #ffc107; color: #ffc107;
      padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer;
    }
    .btn-add-live {
      width: 100%; background: rgba(255, 23, 68, 0.1);
      border: 2px dashed #ff1744; color: #ff1744;
      padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer;
    }
    .btn-delete {
      background: rgba(255, 23, 68, 0.2); border: 2px solid #ff1744;
      color: #ff1744; width: 36px; height: 36px;
      border-radius: 8px; font-size: 18px; cursor: pointer; font-weight: 900;
    }
    .btn-delete-sm {
      background: rgba(255, 23, 68, 0.2); border: 2px solid #ff1744;
      color: #ff1744; width: 32px; height: 32px;
      border-radius: 6px; font-size: 16px; cursor: pointer;
    }
    .btn-back {
      position: absolute; top: 16px; left: 16px;
      background: rgba(0,0,0,0.5); border: 2px solid #ffc107;
      color: white; width: 40px; height: 40px;
      border-radius: 50%; font-size: 18px; cursor: pointer;
    }
    .btn-spy {
      background: linear-gradient(135deg, #ff4da6, #c9377f);
      color: white; border: 2px solid #ffc107;
      padding: 12px 24px; border-radius: 8px;
      font-weight: 900; cursor: pointer;
    }
    .btn-more-time {
      display: none; width: 90%; margin: 16px auto 0;
      background: linear-gradient(135deg, #ffc107, #ff8c00);
      color: #000; border: 3px solid #ffc107;
      padding: 16px; border-radius: 12px;
      font-size: 16px; font-weight: 900; cursor: pointer;
      box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4);
      animation: shimmer 3s infinite;
    }

    /* ===== BADGE ===== */
    .config-badge {
      padding: 6px 12px; border-radius: 8px; font-weight: 900; font-size: 14px;
    }
    .config-badge-red { background: rgba(255,23,68,0.2); border: 1px solid #ff1744; color: #ff1744; }
    .config-badge-pink { background: rgba(255,77,166,0.2); border: 1px solid #ff4da6; color: #ff4da6; }
    .offline-badge {
      background: rgba(0,0,0,0.3); padding: 6px 12px;
      border-radius: 12px; border: 1px solid #ffc107;
    }

    /* ===== BROWSE PAGE (from Demo 1) ===== */
    .search-container { position: relative; padding: 12px 16px; }
    .search-bar {
      width: 100%; background: rgba(0,0,0,0.3);
      border: 2px solid #ffc107; border-radius: 12px;
      padding: 12px 16px; font-size: 16px; color: #fff; outline: none;
    }
    .search-bar::placeholder { color: #ff8a80; }
    .search-bar:focus { border-color: #ff1744; box-shadow: 0 0 12px rgba(255,23,68,0.4); }
    .search-results {
      position: absolute; top: 100%; left: 16px; right: 16px;
      background: #1a0a0a; border: 2px solid #ffc107;
      border-radius: 12px; max-height: 70vh; overflow-y: auto;
      display: none; z-index: 200;
      box-shadow: 0 8px 24px rgba(0,0,0,0.5);
    }
    .search-results.visible { display: block; }
    .search-category {
      padding: 10px 16px; font-size: 13px; font-weight: 900;
      color: #ff1744; border-bottom: 1px solid #2a2020;
    }
    .search-item {
      padding: 12px 16px; display: flex; align-items: center; gap: 12px;
      border-bottom: 1px solid #1a0a0a; cursor: pointer;
    }
    .search-item:active { background: rgba(255,23,68,0.1); }
    .search-icon { font-size: 24px; width: 36px; text-align: center; }
    .search-item-info { flex: 1; }
    .search-item-name { font-size: 15px; font-weight: 700; color: #fff; }
    .search-item-meta { font-size: 12px; color: #ff8a80; margin-top: 2px; }
    .search-live-badge {
      background: #ff1744; color: #fff; font-size: 11px;
      font-weight: 900; padding: 4px 10px; border-radius: 8px;
    }
    .no-results { padding: 20px; text-align: center; color: #666; font-size: 14px; }

    .stats-bar {
      display: flex; align-items: center; gap: 16px;
      padding: 10px 16px; border-bottom: 1px solid #2a2020;
    }
    .stat { font-size: 13px; font-weight: 700; display: flex; align-items: center; gap: 6px; }
    .stat.clubs { margin-left: auto; color: #ffc107; }
    .stat-dot { width: 8px; height: 8px; border-radius: 50%; }

    .state-grid {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; padding: 12px;
    }
    .state-card {
      background: #1a0a0a; border: 2px solid #2a2020; border-radius: 12px;
      padding: 14px; cursor: pointer; transition: all 0.2s;
    }
    .state-card:active { transform: scale(0.97); }
    .state-card.has-live { border-color: #ff1744; box-shadow: 0 2px 12px rgba(255,23,68,0.3); }
    .state-name { font-size: 15px; font-weight: 900; margin-bottom: 4px; }
    .state-counts { display: flex; gap: 8px; margin-bottom: 4px; }
    .count-item { font-size: 12px; font-weight: 700; }
    .count-live { color: #ff1744; }
    .count-offline { color: #666; }
    .state-clubs { font-size: 11px; color: #ffc107; }

    /* ===== OVERLAY & BOTTOM SHEETS ===== */
    .overlay, .sheet-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7); z-index: 150;
      opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .overlay.visible, .sheet-overlay.visible { opacity: 1; pointer-events: auto; }
    .bottom-sheet {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: #1a0a0a; border-top: 3px solid #ffc107;
      border-radius: 20px 20px 0 0; max-height: 85vh;
      overflow-y: auto; z-index: 200;
      transform: translateY(100%); transition: transform 0.3s ease;
    }
    .bottom-sheet.open { transform: translateY(0); }
    .sheet-handle {
      width: 40px; height: 4px; background: #ffc107;
      border-radius: 2px; margin: 12px auto;
    }
    .sheet-header { padding: 8px 16px 16px; position: relative; }
    .sheet-title { font-size: 20px; font-weight: 900; color: #ff1744; }
    .sheet-subtitle { font-size: 13px; color: #ff8a80; margin-top: 4px; }
    .sheet-content { padding: 0 16px 24px; }
    .close-btn {
      position: absolute; top: 8px; right: 16px;
      background: none; border: none; color: #ff8a80;
      font-size: 24px; cursor: pointer;
    }

    /* Sheet items (clubs, streamers) */
    .sheet-item {
      padding: 16px; border-bottom: 1px solid #2a2020;
      cursor: pointer; display: flex; justify-content: space-between; align-items: center;
    }
    .sheet-item:active { background: rgba(255,23,68,0.1); }
    .sheet-item.live { border-left: 4px solid #ff1744; }
    .item-name { font-size: 16px; font-weight: 700; color: #fff; }
    .item-name.live { color: #ff1744; }
    .item-status { font-size: 12px; color: #666; margin-top: 4px; }
    .live-badge {
      display: flex; align-items: center; gap: 6px;
      background: rgba(255,23,68,0.15); padding: 6px 12px;
      border-radius: 8px; border: 1px solid #ff1744;
    }
    .live-badge span { font-size: 12px; color: #ff1744; font-weight: 700; }
    .pulse-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: #ff1744; animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(255,23,68,0.4); }
      50% { opacity: 0.7; box-shadow: 0 0 0 6px rgba(255,23,68,0); }
    }
    .section-header {
      padding: 12px 16px; font-size: 13px; font-weight: 900;
      border-bottom: 1px solid #2a2020;
    }
    .section-header.live { color: #ff1744; }
    .section-header.offline { color: #666; }
    .streamer-item { display: flex; align-items: center; gap: 12px; }
    .streamer-avatar {
      width: 44px; height: 44px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px; font-weight: 900; border: 2px solid #ffc107;
    }
    .streamer-avatar.offline { filter: grayscale(50%); border-color: #666; }
    .streamer-info { flex: 1; }
    .streamer-name { font-size: 15px; font-weight: 700; color: #fff; }
    .streamer-name.live { color: #ff1744; }
    .streamer-name.offline { color: #aaa; }
    .streamer-viewers { font-size: 12px; color: #ff8a80; margin-top: 2px; }
    .streamer-icon { font-size: 18px; }
    .back-btn-sheet {
      background: none; border: 2px solid #ffc107; color: #ffc107;
      padding: 6px 12px; border-radius: 8px; font-size: 14px;
      font-weight: 700; cursor: pointer; margin-right: 12px;
    }

    /* ===== ROOM PAGE ===== */
    .video-container {
      background: linear-gradient(135deg, #1a0a0a, #2a1020);
      padding: 24px 16px; text-align: center;
      border-bottom: 2px solid #ff1744;
    }
    .room-avatar {
      width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 40px; font-weight: 900; border: 3px solid #ffc107;
    }
    .room-name { font-size: 22px; font-weight: 900; color: #ff1744; margin-bottom: 4px; }
    .room-title { font-size: 14px; color: #ff8a80; margin-bottom: 12px; }
    .room-stats { display: flex; gap: 12px; justify-content: center; }
    .stat-badge {
      padding: 6px 14px; border-radius: 8px; font-size: 13px; font-weight: 900;
    }
    .stat-live {
      background: rgba(255,23,68,0.2); color: #ff1744;
      border: 1px solid #ff1744; display: flex; align-items: center;
    }
    .stat-viewers { background: rgba(255,193,7,0.2); color: #ffc107; border: 1px solid #ffc107; }
    .room-controls { display: flex; gap: 12px; margin-top: 16px; }
    .control-btn {
      flex: 1; background: linear-gradient(135deg, #ff4da6, #c9377f);
      border: 2px solid #ffc107; color: white;
      font-size: 15px; font-weight: 900; padding: 14px 20px;
      border-radius: 8px; cursor: pointer;
    }
    .control-btn:active { transform: scale(0.95); }
    .control-btn-alt { background: #1a0a0a; border-color: #ff1744; }
    .room-back-btn {
      position: absolute; top: 12px; left: 12px;
      background: rgba(0,0,0,0.6); border: 2px solid #ffc107; color: #fff;
      width: 36px; height: 36px; border-radius: 50%;
      font-size: 16px; cursor: pointer; z-index: 5;
      display: flex; align-items: center; justify-content: center;
    }
    .private-timer {
      display: none; margin-top: 16px;
      background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(155,89,182,0.2));
      border: 2px solid #ffc107; border-radius: 12px; padding: 16px; text-align: center;
    }
    .timer-label { font-size: 12px; color: #ffc107; margin-bottom: 4px; font-weight: 700; }
    .timer-display { font-size: 32px; font-weight: 900; color: #fff; font-family: monospace; }
    .timer-sub { font-size: 11px; color: #ff8a80; margin-top: 4px; }

    /* Tip Buttons */
    .tip-section { display: flex; gap: 12px; padding: 12px; overflow-x: auto; }
    .tip-btn {
      background: #1a0a0a; border: 2px solid #ff1744; border-radius: 12px;
      padding: 12px 16px; text-align: center; min-width: 100px;
      cursor: pointer; transition: all 0.2s;
    }
    .tip-btn:active { transform: scale(0.95); background: rgba(255,23,68,0.2); }
    .tip-label { font-size: 14px; font-weight: 900; color: #fff; margin-bottom: 4px; }
    .tip-amount { font-size: 13px; color: #ffc107; font-weight: 700; }

    /* Chat */
    .chat-section { padding: 0 12px; }
    .chat-title { font-size: 14px; font-weight: 900; color: #ff1744; padding: 12px 4px 8px; }
    .chat-messages { max-height: 300px; overflow-y: auto; }
    .chat-msg {
      padding: 10px 12px; margin-bottom: 6px;
      background: rgba(255,23,68,0.08); border: 1px solid #2a2020;
      border-radius: 8px; font-size: 14px;
      display: flex; align-items: center; gap: 8px;
    }
    .chat-msg-lovense { border-color: #ff4da6; background: rgba(255,77,166,0.2); }
    .chat-user { color: #ff1744; font-weight: 900; font-size: 13px; }
    .chat-user-pink { color: #ff4da6; }
    .chat-tip-amount { margin-left: auto; font-weight: 900; color: #ffc107; font-size: 18px; }
    .chat-tip-pink { color: #ff4da6; }

    /* Lovense items in room */
    .lovense-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 16px; border-bottom: 1px solid #2a2020; cursor: pointer;
    }
    .lovense-item:active { background: rgba(255,77,166,0.1); }
    .lovense-label { font-size: 16px; font-weight: 700; }
    .lovense-cost { font-size: 15px; font-weight: 900; color: #ffc107; }
    .lovense-duration { font-size: 10px; color: #ff8a80; }

    /* Floating Private Button */
    .floating-private-btn {
      position: fixed; right: 12px; bottom: 80px;
      background: linear-gradient(135deg, #ffc107, #ff8c00);
      border: 3px solid #fff; border-radius: 50px;
      padding: 12px 16px; color: #000;
      box-shadow: 0 6px 20px rgba(255, 193, 7, 0.6);
      cursor: pointer; z-index: 90; text-align: center;
      display: none; /* shown only in room */
    }
    .floating-private-btn:active { transform: scale(0.95); }
    .floating-btn-icon { font-size: 20px; }
    .floating-btn-text { font-size: 10px; font-weight: 900; letter-spacing: 1px; }
    .floating-btn-price { font-size: 11px; font-weight: 700; }
    @keyframes shimmer {
      0%, 100% { box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4); }
      50% { box-shadow: 0 6px 30px rgba(255, 193, 7, 0.8); }
    }

    /* ===== TOKEN PACKAGES ===== */
    .package-grid { display: grid; gap: 16px; padding: 16px; }
    .package-card {
      background: #1a0a0a; border: 2px solid #2a2020;
      border-radius: 12px; padding: 20px; position: relative;
    }
    .package-card.popular { border: 3px solid #ffc107; box-shadow: 0 8px 24px rgba(255,193,7,0.4); }
    .popular-badge {
      position: absolute; top: -12px; left: 16px;
      background: linear-gradient(135deg, #ffc107, #ffb300);
      padding: 6px 16px; border-radius: 12px; font-size: 12px;
      font-weight: 900; color: #000; box-shadow: 0 4px 12px rgba(255,193,7,0.5);
    }
    .package-icon { font-size: 48px; margin-bottom: 8px; }
    .package-name { font-size: 20px; font-weight: 900; margin-bottom: 4px; color: #ffc107; }
    .package-tokens { font-size: 36px; font-weight: 900; color: #ff1744; margin-bottom: 4px; }
    .package-label { font-size: 13px; color: #ff8a80; margin-bottom: 16px; }
    .buy-btn {
      width: 100%; background: linear-gradient(135deg, #ffc107, #ffb300);
      color: #000; padding: 16px; border-radius: 8px; font-size: 18px;
      font-weight: 900; border: 2px solid #ffc107;
      box-shadow: 0 4px 16px rgba(255,193,7,0.3); cursor: pointer;
    }
    .buy-btn:active { transform: scale(0.95); }
    .buy-btn.popular { background: linear-gradient(135deg, #ff1744, #ff6b35); color: #fff; }

    /* ===== DASHBOARD ===== */
    .lovense-level-item {
      background: rgba(255,77,166,0.1); border: 1px solid #ff4da6;
      border-radius: 8px; padding: 12px; margin-bottom: 12px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .schedule-item {
      border-radius: 8px; padding: 12px; margin-bottom: 8px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .schedule-item-online { background: rgba(255,193,7,0.1); border: 1px solid #ffc107; }
    .schedule-item-live { background: rgba(255,23,68,0.1); border: 1px solid #ff1744; }
    .tip-preview-row { display: flex; gap: 12px; overflow-x: auto; }
    .tip-preview-item { min-width: 140px; cursor: default; }
    .config-card {
      background: #1a0a0a; border: 2px solid #ff1744;
      border-radius: 12px; padding: 16px; margin-bottom: 12px;
    }
    .extension-option {
      background: linear-gradient(135deg, rgba(255,193,7,0.15), rgba(255,140,0,0.15));
      border: 2px solid #ffc107; border-radius: 12px;
      padding: 20px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s;
    }
    .extension-option:active { transform: scale(0.98); }
    .timer-box {
      background: rgba(255,193,7,0.1); border: 2px solid #ffc107;
      border-radius: 12px; padding: 16px; text-align: center;
    }
    .max-warning {
      display: none; background: rgba(255,77,166,0.15);
      border: 2px solid #ff4da6; border-radius: 8px;
      padding: 12px; margin-bottom: 16px; text-align: center;
    }

    /* ===== PROFILE PAGE ===== */
    .profile-header {
      background: linear-gradient(135deg, #ff1744, #c62828);
      padding: 24px 16px; position: relative;
    }
    .profile-avatar {
      width: 120px; height: 120px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 60px; font-weight: 900; border: 4px solid #ffc107; margin-bottom: 16px;
    }
    .profile-name { font-size: 28px; font-weight: 900; margin-bottom: 4px; }
    .profile-schedule-item {
      border-radius: 6px; padding: 10px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .profile-schedule-online { background: rgba(255,193,7,0.1); border: 1px solid #ffc107; }
    .profile-schedule-live { background: rgba(255,23,68,0.1); border: 1px solid #ff1744; }
    .empty-state { color: #666; font-size: 13px; text-align: center; padding: 20px; }

  </style>
</head>
<body>

  <!-- Top Header -->
  <div class="top-header">
    <div class="brand">üíé LiveStream</div>
    <div class="token-badge" id="tokenBadge">ü™ô 250</div>
  </div>

  <!-- ==================== BROWSE PAGE ==================== -->
  <div class="page active" id="browsePage">
    <div class="search-container">
      <input type="text" class="search-bar" id="searchBar"
        placeholder="üîç Search states, clubs, streamers..."
        autocomplete="off">
      <div class="search-results" id="searchResults"></div>
    </div>

    <div class="stats-bar">
      <div class="stat">
        <div class="stat-dot" style="background: #ff1744;"></div>
        <span id="liveCount">0 Live</span>
      </div>
      <div class="stat">
        <div class="stat-dot" style="background: #666;"></div>
        <span id="offlineCount">0 Offline</span>
      </div>
      <div class="stat clubs">667 Clubs</div>
    </div>

    <div class="state-grid" id="stateGrid"></div>
  </div>

  <!-- ==================== ROOM PAGE ==================== -->
  <div class="page" id="roomPage">
    <div class="video-container" style="position: relative;">
      <button class="room-back-btn" onclick="leaveRoom()">‚Üê</button>
      <div class="room-avatar" id="roomAvatar"></div>
      <div class="room-name" id="roomName"></div>
      <div class="room-title" id="roomTitle"></div>
      <div class="room-stats">
        <div class="stat-badge stat-live">
          <div class="pulse-dot" style="display:inline-block;vertical-align:middle;"></div>
          <span style="margin-left:6px;">LIVE</span>
        </div>
        <div class="stat-badge stat-viewers" id="roomViewers"></div>
      </div>

      <div class="private-timer" id="privateTimer">
        <div class="timer-label">üîí PRIVATE SHOW</div>
        <div class="timer-display" id="timerDisplay">10:00</div>
        <div class="timer-sub">Time Remaining</div>
      </div>

      <button id="moreTimeBtn" class="btn-more-time" onclick="showMoreTimeOptions()">
        ‚ûï ADD MORE TIME
      </button>

      <div class="room-controls">
        <button class="control-btn" onclick="openLovense()">üî• Lovense</button>
        <button class="control-btn control-btn-alt">üí¨ Chat</button>
      </div>
    </div>

    <div class="tip-section" id="tipButtons"></div>

    <div class="chat-section">
      <div class="chat-title">üí¨ Recent Activity</div>
      <div class="chat-messages" id="chatMessages"></div>
    </div>
  </div>

  <!-- ==================== PROFILE PAGE ==================== -->
  <div class="page" id="profilePage">
    <div class="profile-header">
      <button class="btn-back" onclick="showPage('browse')">‚Üê</button>
      <div class="flex-col-center" style="margin-top:40px;">
        <div class="profile-avatar" id="profileAvatar"></div>
        <h2 class="profile-name" id="profileName"></h2>
        <div class="offline-badge">
          <span class="text-muted text-md">‚ö´ Currently Offline</span>
        </div>
      </div>
    </div>
    <div class="page-pad">
      <!-- Schedule -->
      <div class="card card-dark card-gold mb-16" style="border: 2px solid #ffc107;">
        <h3 class="text-gold mb-16 text-xl">üìÖ Schedule</h3>
        <div class="mb-20">
          <div class="flex-gap mb-12">
            <div class="text-2xl">üü¢</div>
            <div class="text-lg font-bold text-white">Online Hours</div>
          </div>
          <div class="text-muted text-md mb-8">Available for chat & private bookings</div>
          <div class="flex-col-gap" id="profileOnlineSchedule"></div>
        </div>
        <div>
          <div class="flex-gap mb-12">
            <div class="text-2xl">üî¥</div>
            <div class="text-lg font-bold text-red">Live Streaming Hours</div>
          </div>
          <div class="text-muted text-md mb-8">Public shows & broadcasts</div>
          <div class="flex-col-gap" id="profileLiveSchedule"></div>
        </div>
      </div>
      <button class="btn-primary mb-16" onclick="bookPrivateShow()">üìÖ Book Private Show in Advance</button>
      <button class="btn-pink-lg" onclick="sendMessage()">üíå Send Private Message</button>
    </div>
  </div>

  <!-- ==================== TOKENS PAGE ==================== -->
  <div class="page" id="tokensPage">
    <div class="page-pad">
      <h2 class="text-red text-3xl mb-8">üí≥ Buy Tokens</h2>
      <p class="text-muted mb-24">Purchase tokens to tip streamers</p>
    </div>
    <div class="package-grid" id="packageGrid"></div>
  </div>

  <!-- ==================== DASHBOARD PAGE ==================== -->
  <div class="page" id="dashboardPage">
    <div class="page-pad">
      <h2 class="text-red text-3xl mb-20">‚öôÔ∏è Streamer Dashboard</h2>

      <!-- Tip Button Configurator -->
      <div class="card card-red mb-16">
        <div class="flex-between mb-16">
          <h3 class="text-red text-xl">üí∞ Custom Tip Buttons</h3>
          <div class="config-badge config-badge-red">4 buttons</div>
        </div>
        <p class="text-dim text-sm mb-16">Customize the 4 preset tip buttons shown in your room</p>
        <div id="tipButtonEditors"></div>
        <button class="btn-save mt-16" onclick="saveTipButtons()">üíæ Save Tip Buttons</button>
        <div class="section-divider">
          <h4 class="text-gold text-base mb-12">üëÅÔ∏è Preview</h4>
          <div class="tip-preview-row">
            <div id="tipPreview1" class="tip-btn tip-preview-item"><div class="tip-label">üéÅ Small</div><div class="tip-amount">ü™ô 10</div></div>
            <div id="tipPreview2" class="tip-btn tip-preview-item"><div class="tip-label">üíñ Medium</div><div class="tip-amount">ü™ô 50</div></div>
            <div id="tipPreview3" class="tip-btn tip-preview-item"><div class="tip-label">üíù Big</div><div class="tip-amount">ü™ô 100</div></div>
            <div id="tipPreview4" class="tip-btn tip-preview-item"><div class="tip-label">üêã Whale</div><div class="tip-amount">ü™ô 500</div></div>
          </div>
        </div>
      </div>

      <!-- Private Show Settings -->
      <div class="card card-dark card-border mb-16">
        <h3 class="text-gold text-xl mb-16">üîí Private Show Settings</h3>
        <div class="form-group-lg">
          <label class="form-label-md">üí∞ Tokens Per Minute</label>
          <input type="number" id="tokensPerMin" value="60" min="10" max="500" class="form-input form-input-gold">
          <div class="hint">Current: $6/min (60 tokens)</div>
        </div>
        <div class="form-group-lg">
          <label class="form-label-md">‚è±Ô∏è Minimum Duration (minutes)</label>
          <input type="number" id="minDuration" value="10" min="5" max="60" class="form-input form-input-gold">
          <div class="hint">Minimum booking: 10 minutes (600 tokens)</div>
        </div>

        <div class="section-divider">
          <h4 class="text-pink mb-12 text-lg">‚ûï "More Time" Extension Options</h4>
          <p class="text-dim text-sm mb-16">Configure the extension options shown during private shows</p>
          <div class="card-pink mb-12"><div class="grid-2col"><div><label class="form-label-sm">Minutes</label><input type="number" id="ext1Minutes" value="5" min="1" max="60" class="form-input form-input-pink"></div><div><label class="form-label-sm">Tokens</label><input type="number" id="ext1Tokens" value="250" min="10" max="5000" class="form-input form-input-pink"></div></div></div>
          <div class="card-pink mb-12"><div class="grid-2col"><div><label class="form-label-sm">Minutes</label><input type="number" id="ext2Minutes" value="10" min="1" max="60" class="form-input form-input-pink"></div><div><label class="form-label-sm">Tokens</label><input type="number" id="ext2Tokens" value="450" min="10" max="5000" class="form-input form-input-pink"></div></div></div>
          <div class="card-pink mb-12"><div class="grid-2col"><div><label class="form-label-sm">Minutes</label><input type="number" id="ext3Minutes" value="15" min="1" max="60" class="form-input form-input-pink"></div><div><label class="form-label-sm">Tokens</label><input type="number" id="ext3Tokens" value="650" min="10" max="5000" class="form-input form-input-pink"></div></div></div>
        </div>
        <button class="btn-save mt-16" onclick="savePrivateSettings()">üíæ Save Settings</button>
      </div>

      <!-- Preview -->
      <div class="card card-gold mb-16" style="padding:16px;">
        <h4 class="text-gold text-base mb-8">üëÅÔ∏è Preview</h4>
        <div class="text-md text-muted leading-relaxed">
          <div><strong class="text-white">Floating button:</strong> $<span id="previewPrice">6</span>/min</div>
          <div><strong class="text-white">Minimum cost:</strong> <span id="previewMinCost">600</span> tokens ($<span id="previewMinCostUSD">60</span>)</div>
          <div class="mt-8"><strong class="text-white">Extensions:</strong></div>
          <div>‚Ä¢ +<span id="previewExt1Min">5</span> min = <span id="previewExt1Tokens">250</span> tokens</div>
          <div>‚Ä¢ +<span id="previewExt2Min">10</span> min = <span id="previewExt2Tokens">450</span> tokens</div>
          <div>‚Ä¢ +<span id="previewExt3Min">15</span> min = <span id="previewExt3Tokens">650</span> tokens</div>
        </div>
      </div>

      <!-- Lovense Configurator -->
      <div class="card card-dark mb-16" style="border: 2px solid #ff4da6;">
        <div class="flex-between mb-16">
          <h3 class="text-pink text-xl">üíó Lovense Control Levels</h3>
          <div class="config-badge config-badge-pink" id="lovenseLevelCount">4/5</div>
        </div>
        <div id="lovenseLevelsList"></div>
        <div class="max-warning" id="lovenseMaxWarning">
          <div class="text-pink font-bold text-md">‚ö†Ô∏è Maximum 5 levels reached</div>
          <div class="text-muted text-xs" style="margin-top:4px;">Delete a level to add a new one</div>
        </div>
        <div id="lovenseAddForm">
          <div class="card card-pink-dashed" style="padding:16px;">
            <h4 class="text-pink text-base mb-12">‚ûï Add New Level</h4>
            <div class="form-group">
              <label class="form-label">Icon</label>
              <select id="newLovenseIcon" class="form-select">
                <option value="üíó">üíó Heart</option><option value="üíñ">üíñ Sparkling Heart</option>
                <option value="üíù">üíù Gift Heart</option><option value="üî•">üî• Fire</option>
                <option value="‚ö°">‚ö° Lightning</option><option value="üí•">üí• Boom</option>
                <option value="üåü">üåü Star</option><option value="‚ú®">‚ú® Sparkles</option>
                <option value="üåä">üåä Wave</option><option value="üéÜ">üéÜ Fireworks</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Label</label>
              <input type="text" id="newLovenseLabel" placeholder="e.g., Low Vibe, Earthquake" maxlength="20" class="form-input" style="border-color:#ff4da6;">
            </div>
            <div class="grid-2col mb-12">
              <div><label class="form-label">Tokens</label><input type="number" id="newLovenseTokens" value="15" min="1" max="1000" class="form-input" style="border-color:#ff4da6;"></div>
              <div><label class="form-label">Duration (sec)</label><input type="number" id="newLovenseDuration" value="10" min="1" max="300" class="form-input" style="border-color:#ff4da6;"></div>
            </div>
            <button class="btn-pink w-full" onclick="addLovenseLevel()">‚ûï Add Level</button>
          </div>
        </div>
      </div>

      <!-- Schedule Configurator -->
      <div class="card card-dark mt-16" style="border: 2px solid #ffc107;">
        <h3 class="text-gold text-xl mb-16">üìÖ My Schedule</h3>
        <p class="text-dim text-sm mb-20">Set your availability for chat and streaming</p>
        <div class="section-border-bottom">
          <div class="flex-gap mb-12"><div class="text-3xl">üü¢</div><h4 class="text-white text-lg font-bold">Online Hours</h4></div>
          <p class="text-muted text-sm mb-12">When you're available for chat & private bookings</p>
          <div id="onlineScheduleList"></div>
          <button class="btn-add-online mt-12" onclick="addOnlineSchedule()">‚ûï Add Online Hours</button>
        </div>
        <div>
          <div class="flex-gap mb-12"><div class="text-3xl">üî¥</div><h4 class="text-red text-lg font-bold">Live Streaming Hours</h4></div>
          <p class="text-muted text-sm mb-12">When you're broadcasting public shows</p>
          <div id="liveScheduleList"></div>
          <button class="btn-add-live mt-12" onclick="addLiveSchedule()">‚ûï Add Live Hours</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== BOTTOM NAV ==================== -->
  <nav class="bottom-nav">
    <button class="nav-item active" onclick="showPage('browse')">
      <div class="nav-item-icon">üîç</div><div>Browse</div>
    </button>
    <button class="nav-item" onclick="showPage('tokens')">
      <div class="nav-item-icon">üí≥</div><div>Wallet</div>
    </button>
    <button class="nav-item" onclick="showPage('dashboard')">
      <div class="nav-item-icon">‚öôÔ∏è</div><div>Settings</div>
    </button>
  </nav>

  <!-- Floating Private Show Button (room only) -->
  <button class="floating-private-btn" id="floatingPrivateBtn" onclick="openPrivateSheet()">
    <div class="floating-btn-icon">üîí</div>
    <div class="floating-btn-text">PRIVATE</div>
    <div class="floating-btn-price">$6/min</div>
  </button>

  <!-- ==================== BROWSE SHEETS ==================== -->
  <div class="overlay" id="browseOverlay"></div>
  <div class="bottom-sheet" id="clubSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-header">
      <h2 class="sheet-title" id="clubSheetTitle"></h2>
      <p class="sheet-subtitle" id="clubSheetSubtitle"></p>
    </div>
    <div class="sheet-content" id="clubSheetContent"></div>
  </div>
  <div class="bottom-sheet" id="streamerSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-header" style="display:flex;align-items:center;">
      <button class="back-btn-sheet" id="backBtn">‚Üê</button>
      <div>
        <h2 class="sheet-title" id="streamerSheetTitle"></h2>
        <p class="sheet-subtitle" id="streamerSheetSubtitle"></p>
      </div>
    </div>
    <div class="sheet-content" id="streamerSheetContent"></div>
  </div>

  <!-- ==================== ROOM SHEETS ==================== -->
  <div class="sheet-overlay" id="lovenseOverlay" onclick="closeLovense()"></div>
  <div class="bottom-sheet" id="lovenseSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-header">
      <div class="sheet-title">üî• Lovense Control</div>
      <div class="sheet-subtitle">Lush 4 ‚Ä¢ üîã 87%</div>
      <button class="close-btn" onclick="closeLovense()">‚úï</button>
    </div>
    <div class="sheet-content" id="lovenseContent"></div>
  </div>

  <div class="sheet-overlay" id="privateOverlay" onclick="closePrivateSheet()"></div>
  <div class="bottom-sheet" id="privateSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-header">
      <div class="sheet-title text-gold">üîí Private Show</div>
      <div class="sheet-subtitle">Exclusive 1-on-1 experience</div>
      <button class="close-btn" onclick="closePrivateSheet()">‚úï</button>
    </div>
    <div class="sheet-content">
      <div class="card-premium mb-20">
        <div class="text-center mb-20">
          <div class="text-giant mb-12">üëë</div>
          <div class="text-2xl font-black text-gold mb-4">Exclusive 1-on-1 Show</div>
          <div class="text-base text-muted">Just you and the streamer</div>
        </div>
        <div class="grid-2col mb-20">
          <div class="card-stat"><div class="text-4xl font-black text-gold">$6</div><div class="text-sm text-muted">per minute</div></div>
          <div class="card-stat"><div class="text-4xl font-black text-gold">10 min</div><div class="text-sm text-muted">minimum</div></div>
        </div>
        <div class="card-included mb-20">
          <div class="text-base font-bold text-gold mb-8">‚ú® What's Included:</div>
          <div class="text-md text-muted leading-loose">
            ‚Ä¢ Full control of the show<br>‚Ä¢ Two-way audio & video<br>‚Ä¢ Custom requests welcome<br>‚Ä¢ Lovense toy control included<br>‚Ä¢ Recording available (+$20)
          </div>
        </div>
        <button class="btn-primary mb-16" onclick="startPrivateShow()">üîí START PRIVATE SHOW ($60)</button>
      </div>
      <div class="card-spy">
        <div class="flex-gap-lg mb-12">
          <div style="font-size:40px;">üëÅÔ∏è</div>
          <div>
            <div class="text-xl font-black text-pink mb-4">Spy Mode Available</div>
            <div class="text-md text-muted">Watch someone else's private show</div>
          </div>
        </div>
        <div class="flex-between mt-16">
          <div>
            <div class="text-2xl font-black text-pink">$3/min</div>
            <div class="text-xs text-muted">Watch only ‚Ä¢ No interaction</div>
          </div>
          <button class="btn-spy" onclick="joinSpyMode()">JOIN SPY</button>
        </div>
      </div>
    </div>
  </div>

  <div class="sheet-overlay" id="moreTimeOverlay" onclick="closeMoreTimeSheet()"></div>
  <div class="bottom-sheet" id="moreTimeSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-header">
      <div class="sheet-title text-gold">‚ûï Add More Time</div>
      <div class="sheet-subtitle">Extend your private show</div>
      <button class="close-btn" onclick="closeMoreTimeSheet()">‚úï</button>
    </div>
    <div class="sheet-content">
      <div class="timer-box mb-16">
        <div class="text-base text-muted mb-8">‚è±Ô∏è Current Time Remaining</div>
        <div class="text-5xl font-black text-white" style="font-family:monospace;" id="moreTimeCurrentTimer">10:00</div>
      </div>
      <div id="extensionOptions"></div>
    </div>
  </div>

  <script>
    // ============================================
    // DATABASE ABSTRACTION LAYER (inlined)
    // ============================================
/**
 * LiveStream Tips - Database Abstraction Layer
 * 
 * TEMPORARY: Uses localStorage for client-side storage
 * PRODUCTION: Swap commented sections to use real API/database
 * 
 * This file provides a unified interface for all data operations.
 * When ready for production, simply uncomment the production code
 * and comment out the temporary code. Your app code won't need to change!
 */

class Database {
  constructor() {
    this.initializeDefaults();
  }

  /**
   * Initialize default data if nothing exists in localStorage
   */
  initializeDefaults() {
    // Only set defaults if nothing exists
    if (!localStorage.getItem('livestream_initialized')) {
      // User data
      this.setBalance(250);
      
      // Default tip buttons
      this.saveTipButtons([
        { icon: 'üéÅ', label: 'Small', amount: 10 },
        { icon: 'üíñ', label: 'Medium', amount: 50 },
        { icon: 'üíù', label: 'Big', amount: 100 },
        { icon: 'üêã', label: 'Whale', amount: 500 }
      ]);
      
      // Default Lovense levels
      this.saveLovenseLevels([
        { id: 1, icon: 'üíó', label: 'Low Vibe', tokens: 15, duration: 10 },
        { id: 2, icon: 'üíñ', label: 'Medium Vibe', tokens: 30, duration: 15 },
        { id: 3, icon: 'üíù', label: 'High Vibe', tokens: 60, duration: 20 },
        { id: 4, icon: 'üî•', label: 'Ultra Vibe', tokens: 100, duration: 30 }
      ]);
      
      // Default schedules
      this.saveOnlineSchedule([
        { id: 1, day: 'Monday', startTime: '18:00', endTime: '23:00' },
        { id: 2, day: 'Wednesday', startTime: '19:00', endTime: '00:00' },
        { id: 3, day: 'Friday', startTime: '20:00', endTime: '02:00' }
      ]);
      
      this.saveLiveSchedule([
        { id: 1, day: 'Monday', startTime: '20:00', endTime: '22:00' },
        { id: 2, day: 'Friday', startTime: '21:00', endTime: '23:00' }
      ]);
      
      // Default private show settings
      this.savePrivateShowSettings({
        tokensPerMin: 60,
        minDuration: 10,
        extensions: [
          { minutes: 5, tokens: 250 },
          { minutes: 10, tokens: 450 },
          { minutes: 15, tokens: 650 }
        ]
      });
      
      localStorage.setItem('livestream_initialized', 'true');
    }
  }

  // ============================================
  // USER / WALLET METHODS
  // ============================================

  /**
   * Get user's token balance
   * @returns {number} Token balance
   */
  getBalance() {
    // TEMPORARY: localStorage
    const balance = localStorage.getItem('livestream_balance');
    return balance ? parseInt(balance) : 250;
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/user/balance', {
    //   headers: { 'Authorization': `Bearer ${this.getAuthToken()}` }
    // });
    // const data = await response.json();
    // return data.balance;
  }

  /**
   * Set user's token balance
   * @param {number} amount - New balance
   */
  setBalance(amount) {
    // TEMPORARY: localStorage
    localStorage.setItem('livestream_balance', amount.toString());
    
    // PRODUCTION: Don't allow direct balance setting
    // Balance should only be updated server-side after validated transactions
    // This method would not exist in production
  }

  /**
   * Add tokens to balance (purchase)
   * @param {number} amount - Tokens to add
   * @returns {Object} Transaction result
   */
  async addTokens(amount) {
    // TEMPORARY: localStorage
    const current = this.getBalance();
    this.setBalance(current + amount);
    
    // Save transaction
    this.addTransaction({
      type: 'purchase',
      amount: amount,
      timestamp: Date.now()
    });
    
    return { success: true, newBalance: current + amount };
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/wallet/purchase', {
    //   method: 'POST',
    //   headers: { 
    //     'Authorization': `Bearer ${this.getAuthToken()}`,
    //     'Content-Type': 'application/json'
    //   },
    //   body: JSON.stringify({ amount, paymentMethod: 'ccbill' })
    // });
    // return response.json();
  }

  /**
   * Deduct tokens from balance
   * @param {number} amount - Tokens to deduct
   * @param {string} reason - Transaction reason (tip, private, lovense)
   * @returns {Object} Transaction result
   */
  async deductTokens(amount, reason = 'unknown') {
    // TEMPORARY: localStorage
    const current = this.getBalance();
    
    if (current < amount) {
      return { success: false, error: 'Insufficient balance' };
    }
    
    this.setBalance(current - amount);
    
    // Save transaction
    this.addTransaction({
      type: reason,
      amount: -amount,
      timestamp: Date.now()
    });
    
    return { success: true, newBalance: current - amount };
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/wallet/spend', {
    //   method: 'POST',
    //   headers: { 
    //     'Authorization': `Bearer ${this.getAuthToken()}`,
    //     'Content-Type': 'application/json'
    //   },
    //   body: JSON.stringify({ amount, reason, streamerId })
    // });
    // return response.json();
  }

  // ============================================
  // TIP BUTTONS
  // ============================================

  /**
   * Get custom tip buttons
   * @returns {Array} Array of tip button configs
   */
  getTipButtons() {
    // TEMPORARY: localStorage
    const stored = localStorage.getItem('livestream_tip_buttons');
    return stored ? JSON.parse(stored) : [];
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/dashboard/tip-buttons', {
    //   headers: { 'Authorization': `Bearer ${this.getAuthToken()}` }
    // });
    // return response.json();
  }

  /**
   * Save custom tip buttons
   * @param {Array} buttons - Array of tip button configs
   */
  saveTipButtons(buttons) {
    // TEMPORARY: localStorage
    localStorage.setItem('livestream_tip_buttons', JSON.stringify(buttons));
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/dashboard/tip-buttons', {
    //   method: 'PUT',
    //   headers: { 
    //     'Authorization': `Bearer ${this.getAuthToken()}`,
    //     'Content-Type': 'application/json'
    //   },
    //   body: JSON.stringify({ buttons })
    // });
    // return response.json();
  }

  // ============================================
  // LOVENSE LEVELS
  // ============================================

  /**
   * Get Lovense control levels
   * @returns {Array} Array of Lovense level configs
   */
  getLovenseLevels() {
    // TEMPORARY: localStorage
    const stored = localStorage.getItem('livestream_lovense_levels');
    return stored ? JSON.parse(stored) : [];
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/dashboard/lovense-levels', {
    //   headers: { 'Authorization': `Bearer ${this.getAuthToken()}` }
    // });
    // return response.json();
  }

  /**
   * Save Lovense control levels
   * @param {Array} levels - Array of Lovense level configs
   */
  saveLovenseLevels(levels) {
    // TEMPORARY: localStorage
    localStorage.setItem('livestream_lovense_levels', JSON.stringify(levels));
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/dashboard/lovense-levels', {
    //   method: 'PUT',
    //   headers: { 
    //     'Authorization': `Bearer ${this.getAuthToken()}`,
    //     'Content-Type': 'application/json'
    //   },
    //   body: JSON.stringify({ levels })
    // });
    // return response.json();
  }

  // ============================================
  // SCHEDULES
  // ============================================

  /**
   * Get online hours schedule
   * @returns {Array} Array of schedule slots
   */
  getOnlineSchedule() {
    // TEMPORARY: localStorage
    const stored = localStorage.getItem('livestream_online_schedule');
    return stored ? JSON.parse(stored) : [];
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/dashboard/schedule/online', {
    //   headers: { 'Authorization': `Bearer ${this.getAuthToken()}` }
    // });
    // return response.json();
  }

  /**
   * Save online hours schedule
   * @param {Array} schedule - Array of schedule slots
   */
  saveOnlineSchedule(schedule) {
    // TEMPORARY: localStorage
    localStorage.setItem('livestream_online_schedule', JSON.stringify(schedule));
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/dashboard/schedule/online', {
    //   method: 'PUT',
    //   headers: { 
    //     'Authorization': `Bearer ${this.getAuthToken()}`,
    //     'Content-Type': 'application/json'
    //   },
    //   body: JSON.stringify({ schedule })
    // });
    // return response.json();
  }

  /**
   * Get live streaming hours schedule
   * @returns {Array} Array of schedule slots
   */
  getLiveSchedule() {
    // TEMPORARY: localStorage
    const stored = localStorage.getItem('livestream_live_schedule');
    return stored ? JSON.parse(stored) : [];
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/dashboard/schedule/live', {
    //   headers: { 'Authorization': `Bearer ${this.getAuthToken()}` }
    // });
    // return response.json();
  }

  /**
   * Save live streaming hours schedule
   * @param {Array} schedule - Array of schedule slots
   */
  saveLiveSchedule(schedule) {
    // TEMPORARY: localStorage
    localStorage.setItem('livestream_live_schedule', JSON.stringify(schedule));
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/dashboard/schedule/live', {
    //   method: 'PUT',
    //   headers: { 
    //     'Authorization': `Bearer ${this.getAuthToken()}`,
    //     'Content-Type': 'application/json'
    //   },
    //   body: JSON.stringify({ schedule })
    // });
    // return response.json();
  }

  // ============================================
  // PRIVATE SHOW SETTINGS
  // ============================================

  /**
   * Get private show settings
   * @returns {Object} Private show configuration
   */
  getPrivateShowSettings() {
    // TEMPORARY: localStorage
    const stored = localStorage.getItem('livestream_private_settings');
    return stored ? JSON.parse(stored) : {
      tokensPerMin: 60,
      minDuration: 10,
      extensions: []
    };
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/dashboard/private-settings', {
    //   headers: { 'Authorization': `Bearer ${this.getAuthToken()}` }
    // });
    // return response.json();
  }

  /**
   * Save private show settings
   * @param {Object} settings - Private show configuration
   */
  savePrivateShowSettings(settings) {
    // TEMPORARY: localStorage
    localStorage.setItem('livestream_private_settings', JSON.stringify(settings));
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/dashboard/private-settings', {
    //   method: 'PUT',
    //   headers: { 
    //     'Authorization': `Bearer ${this.getAuthToken()}`,
    //     'Content-Type': 'application/json'
    //   },
    //   body: JSON.stringify(settings)
    // });
    // return response.json();
  }

  // ============================================
  // TRANSACTIONS / HISTORY
  // ============================================

  /**
   * Get transaction history
   * @param {number} limit - Max number of transactions to return
   * @returns {Array} Array of transactions
   */
  getTransactions(limit = 50) {
    // TEMPORARY: localStorage
    const stored = localStorage.getItem('livestream_transactions');
    const transactions = stored ? JSON.parse(stored) : [];
    return transactions.slice(0, limit);
    
    // PRODUCTION: Replace with API call
    // const response = await fetch(`/api/transactions?limit=${limit}`, {
    //   headers: { 'Authorization': `Bearer ${this.getAuthToken()}` }
    // });
    // return response.json();
  }

  /**
   * Add a transaction to history
   * @param {Object} transaction - Transaction details
   */
  addTransaction(transaction) {
    // TEMPORARY: localStorage
    const stored = localStorage.getItem('livestream_transactions');
    const transactions = stored ? JSON.parse(stored) : [];
    
    transactions.unshift({
      id: Date.now(),
      ...transaction
    });
    
    // Keep only last 100 transactions
    const trimmed = transactions.slice(0, 100);
    localStorage.setItem('livestream_transactions', JSON.stringify(trimmed));
    
    // PRODUCTION: Server handles this automatically
    // Transactions are created server-side, not client-side
  }

  // ============================================
  // STREAMERS
  // ============================================

  /**
   * Get streamer profile by ID
   * @param {string} streamerId - Streamer ID
   * @returns {Object} Streamer profile data
   */
  async getStreamerProfile(streamerId) {
    // TEMPORARY: Return mock data (would need actual streamer database)
    return {
      id: streamerId,
      name: 'Crystal Rose',
      avatar: 'C',
      color: '#ff5733',
      isLive: false,
      viewers: 0,
      onlineSchedule: this.getOnlineSchedule(),
      liveSchedule: this.getLiveSchedule()
    };
    
    // PRODUCTION: Replace with API call
    // const response = await fetch(`/api/streamers/${streamerId}`, {
    //   headers: { 'Authorization': `Bearer ${this.getAuthToken()}` }
    // });
    // return response.json();
  }

  /**
   * Get list of all streamers
   * @param {Object} filters - Filter options (isLive, category, etc.)
   * @returns {Array} Array of streamers
   */
  async getStreamers(filters = {}) {
    // TEMPORARY: Return mock data
    return [];
    
    // PRODUCTION: Replace with API call
    // const queryString = new URLSearchParams(filters).toString();
    // const response = await fetch(`/api/streamers?${queryString}`);
    // return response.json();
  }

  // ============================================
  // MESSAGES (Placeholder)
  // ============================================

  /**
   * Get messages inbox
   * @returns {Array} Array of messages
   */
  async getMessages() {
    // TEMPORARY: Return empty array
    return [];
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/messages/inbox', {
    //   headers: { 'Authorization': `Bearer ${this.getAuthToken()}` }
    // });
    // return response.json();
  }

  /**
   * Send a message
   * @param {string} toUserId - Recipient user ID
   * @param {string} content - Message content
   * @returns {Object} Send result
   */
  async sendMessage(toUserId, content) {
    // TEMPORARY: Just return success
    return { success: true, messageId: Date.now() };
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/messages/send', {
    //   method: 'POST',
    //   headers: { 
    //     'Authorization': `Bearer ${this.getAuthToken()}`,
    //     'Content-Type': 'application/json'
    //   },
    //   body: JSON.stringify({ toUserId, content })
    // });
    // return response.json();
  }

  // ============================================
  // AUTHENTICATION (For Production)
  // ============================================

  /**
   * Get authentication token
   * @returns {string} JWT token
   */
  getAuthToken() {
    // TEMPORARY: Not needed for localStorage
    return null;
    
    // PRODUCTION: Return JWT from secure storage
    // return sessionStorage.getItem('auth_token');
  }

  /**
   * Login user
   * @param {string} username - Username
   * @param {string} password - Password
   * @returns {Object} Login result with token
   */
  async login(username, password) {
    // TEMPORARY: Skip authentication
    return { success: true, token: null };
    
    // PRODUCTION: Replace with API call
    // const response = await fetch('/api/auth/login', {
    //   method: 'POST',
    //   headers: { 'Content-Type': 'application/json' },
    //   body: JSON.stringify({ username, password })
    // });
    // const data = await response.json();
    // if (data.token) {
    //   sessionStorage.setItem('auth_token', data.token);
    // }
    // return data;
  }

  /**
   * Logout user
   */
  async logout() {
    // TEMPORARY: Clear all localStorage
    const keys = Object.keys(localStorage).filter(k => k.startsWith('livestream_'));
    keys.forEach(key => localStorage.removeItem(key));
    
    // PRODUCTION: Replace with API call
    // await fetch('/api/auth/logout', {
    //   method: 'POST',
    //   headers: { 'Authorization': `Bearer ${this.getAuthToken()}` }
    // });
    // sessionStorage.removeItem('auth_token');
  }

  // ============================================
  // UTILITY METHODS
  // ============================================

  /**
   * Clear all data (for testing)
   */
  clearAllData() {
    const keys = Object.keys(localStorage).filter(k => k.startsWith('livestream_'));
    keys.forEach(key => localStorage.removeItem(key));
    this.initializeDefaults();
  }

  /**
   * Export all data (for backup)
   * @returns {Object} All user data
   */
  exportData() {
    return {
      balance: this.getBalance(),
      tipButtons: this.getTipButtons(),
      lovenseLevels: this.getLovenseLevels(),
      onlineSchedule: this.getOnlineSchedule(),
      liveSchedule: this.getLiveSchedule(),
      privateSettings: this.getPrivateShowSettings(),
      transactions: this.getTransactions()
    };
  }

  /**
   * Import data (for restore)
   * @param {Object} data - Data to import
   */
  importData(data) {
    if (data.balance) this.setBalance(data.balance);
    if (data.tipButtons) this.saveTipButtons(data.tipButtons);
    if (data.lovenseLevels) this.saveLovenseLevels(data.lovenseLevels);
    if (data.onlineSchedule) this.saveOnlineSchedule(data.onlineSchedule);
    if (data.liveSchedule) this.saveLiveSchedule(data.liveSchedule);
    if (data.privateSettings) this.savePrivateShowSettings(data.privateSettings);
  }
}

// ============================================
// EXPORT SINGLETON INSTANCE
// ============================================

// Create and export a single instance
const db = new Database();

// For browser (no module system)

if (typeof window !== 'undefined') { window.db = db; }

    // ============================================
    // APPLICATION
    // ============================================

    // ============================================
    // DATA
    // ============================================
    const CLUBS = {"AK":["Club SinRock","The Crazy Horse"],"AL":["Diamonds Gentlemen's Club","Paradise Gentlemen's Club"],"AR":["Centerfold","Cheyenne Gentlemen's Club"],"AZ":["Bandaids Showclub","Cheetahs Gentlemen's Club"],"CA":["Centerfolds","Cheetahs","Spearmint Rhino","Gold Club SF"],"CO":["Diamond Cabaret","PT's Showclub","Shotgun Willie's"],"CT":["Hollywood Cabaret","Pure Platinum"],"DE":["Cheeks","Fairways Inn"],"FL":["E11EVEN Miami","King of Diamonds (KOD)","Mons Venus","Tootsie's Cabaret"],"GA":["Magic City","Blue Flame Lounge","Clermont Lounge"],"HI":["Club 550","Club Femme Nu"],"IA":["Spearmint Rhino","Dancers Ranch"],"ID":["Stateline Showgirls","Satin Dolls"],"IL":["Larry Flynt's Hustler Club","Rick's Cabaret"],"IN":["Brad's Brass Flamingo","PT's Showclub"],"KS":["Baby Dolls","Executive Lounge"],"KY":["Spearmint Rhino","PT's Showclub"],"LA":["Larry Flynt's Hustler Club","Rick's Cabaret"],"MA":["Centerfolds","Glass Slipper","Golden Banana"],"MD":["Larry Flynt's Hustler Club","Rick's Cabaret"],"ME":["Platinum Plus"],"MI":["Flight Club","Penthouse Club","Henry the 8th"],"MN":["Rick's Cabaret","Spearmint Rhino"],"MO":["Club V","Crazyhorse"],"MS":["Babes Show Club","The Pony"],"MT":["Shotgun Willie's","Teasers GC"],"NC":["Rick's Cabaret","The Gold Club"],"ND":["The Northern"],"NE":["Club Omaha","The Foxy GC"],"NH":["Leather and Lace","Sugaz GC"],"NJ":["Satin Dolls","Delilah's Den"],"NM":["Spearmint Rhino","Fantasies"],"NV":["Sapphire Las Vegas","Spearmint Rhino","Little Darlings","Treasures"],"NY":["Hustler Club NYC","Rick's Cabaret NYC"],"OH":["Larry Flynt's Hustler Club","Columbus Gold"],"OK":["Night Trips Tulsa","Sensations"],"OR":["Acropolis Steakhouse","Mary's Club"],"PA":["Rick's Cabaret","Cheerleaders Philly"],"RI":["The Foxy Lady","Rhode Island Dolls"],"SC":["Platinum West","Cheetah Premier"],"SD":["Shotgun Willie's","Kongo Klub"],"TN":["Hustler Club","Deja Vu Showgirls"],"TX":["Rick's Cabaret DFW","The Men's Club","Baby Dolls"],"UT":["Southern X-Posure","The American Bush"],"VA":["Paper Moon","Pure Pleasure"],"VT":["The Den"],"WA":["Dream Girls at SoDo","Deja Vu Showgirls"],"WI":["Silk Exotic Madison","Peppermint Hippo"],"WV":["Southern X-Posure","The Filly"],"WY":["Green Door Lounge","Paradise Lounge"]};

    const STATE_NAMES = {AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"};

    const FIRST_NAMES = ["Amber","Crystal","Diamond","Jade","Ruby","Sapphire","Luna","Star","Angel","Heaven","Candy","Sugar","Honey","Cherry","Peach"];
    const LAST_NAMES = ["Rose","Sky","Star","Night","Dawn","Love","Dreams","Fire","Ice","Storm","Rain","Snow","Moon","Sun","Divine"];
    const TITLES = ["Feeling playful tonight üíã","Come say hi! üåü","Private shows open üîí","New here, be nice üíñ","Birthday week! üéâ","Just vibing ‚ú®","Ask me anything üí¨","Late night fun üåô"];

    const PACKAGES = [
      { name: "Starter", tokens: 100, price: 4.99, popular: false },
      { name: "Popular", tokens: 500, price: 19.99, popular: true },
      { name: "Pro", tokens: 1200, price: 39.99, popular: false },
      { name: "Whale", tokens: 5000, price: 149.99, popular: false }
    ];

    // ============================================
    // STATE
    // ============================================
    let counts = {};
    let allStreamers = [];
    let currentStreamer = null;
    let currentProfile = null;
    let isInPrivateShow = false;
    let privateShowTimeRemaining = 0;
    let privateShowTimer = null;
    let chatHistory = [
      { type: "system", text: "Welcome to the stream!" },
      { type: "tip", user: "viewer_42", text: "hey! üëã" },
      { type: "tip", user: "BigSpender", amount: 100, label: "üî•" }
    ];

    // ============================================
    // BROWSE FUNCTIONS
    // ============================================
    function initBrowse() {
      Object.keys(CLUBS).forEach(state => {
        const clubCount = CLUBS[state].length;
        counts[state] = {
          live: Math.floor(Math.random() * Math.min(clubCount, 8)),
          offline: Math.floor(Math.random() * Math.min(clubCount * 2, 15))
        };
      });

      Object.entries(CLUBS).forEach(([state, clubs]) => {
        clubs.forEach(club => {
          allStreamers.push(...generateStreamers(club, state));
        });
      });

      renderStateGrid();
      updateBrowseStats();
    }

    function generateStreamers(clubName, stateAbbr) {
      const seed = clubName.split('').reduce((acc, c) => acc + c.charCodeAt(0), 0);
      const count = 3 + (seed % 6);
      const liveCount = Math.floor(Math.random() * Math.min(count, 4));
      const streamers = [];

      for (let i = 0; i < count; i++) {
        const firstName = FIRST_NAMES[((seed + i * 7) % FIRST_NAMES.length)];
        const lastName = LAST_NAMES[((seed + i * 13) % LAST_NAMES.length)];
        const isLive = i < liveCount;
        const hue = (seed + i * 30) % 360;

        streamers.push({
          id: `${stateAbbr}-${clubName.replace(/[^a-zA-Z0-9]/g, '')}-${i}`,
          name: `${firstName} ${lastName}`,
          club: clubName, state: stateAbbr,
          isLive, viewers: isLive ? Math.floor(Math.random() * 500) + 50 : 0,
          avatar: firstName[0], color: `hsl(${hue}, 70%, 50%)`,
          title: TITLES[(seed + i) % TITLES.length]
        });
      }
      return streamers;
    }

    function renderStateGrid() {
      const grid = document.getElementById('stateGrid');
      const sorted = Object.keys(STATE_NAMES).sort((a, b) => {
        const aL = counts[a]?.live || 0, bL = counts[b]?.live || 0;
        if (aL > 0 && bL === 0) return -1;
        if (bL > 0 && aL === 0) return 1;
        return STATE_NAMES[a].localeCompare(STATE_NAMES[b]);
      });

      grid.innerHTML = sorted.map(abbr => {
        const c = counts[abbr] || {live:0, offline:0};
        const clubs = CLUBS[abbr]?.length || 0;
        return `
          <div class="state-card ${c.live > 0 ? 'has-live' : ''}" onclick="openState('${abbr}')">
            <div class="state-name">${STATE_NAMES[abbr]}</div>
            <div class="state-counts">
              ${c.live > 0 ? `<div class="count-item"><span class="count-live">üî¥ ${c.live}</span></div>` : ''}
              ${c.offline > 0 ? `<div class="count-item"><span class="count-offline">‚ö´ ${c.offline}</span></div>` : ''}
            </div>
            <div class="state-clubs">${clubs} clubs</div>
          </div>`;
      }).join('');
    }

    function updateBrowseStats() {
      const totalLive = Object.values(counts).reduce((s, c) => s + c.live, 0);
      const totalOffline = Object.values(counts).reduce((s, c) => s + c.offline, 0);
      document.getElementById('liveCount').textContent = `${totalLive} Live`;
      document.getElementById('offlineCount').textContent = `${totalOffline} Offline`;
    }

    // Search
    const searchBar = document.getElementById('searchBar');
    const searchResults = document.getElementById('searchResults');

    searchBar.addEventListener('input', (e) => {
      const q = e.target.value.trim().toLowerCase();
      if (!q) { searchResults.classList.remove('visible'); return; }

      const states = Object.entries(STATE_NAMES)
        .filter(([a, n]) => n.toLowerCase().includes(q) || a.toLowerCase().includes(q)).slice(0, 5);

      const clubs = [];
      Object.entries(CLUBS).forEach(([st, cl]) => {
        cl.forEach(c => { if (c.toLowerCase().includes(q)) clubs.push({name: c, state: st}); });
      });

      const streamers = allStreamers.filter(s => s.name.toLowerCase().includes(q)).slice(0, 5);

      let html = '';
      if (states.length) {
        html += '<div class="search-category">üó∫Ô∏è States</div>';
        states.forEach(([abbr, name]) => {
          const c = counts[abbr] || {live:0, offline:0};
          html += `<div class="search-item" onclick="selectState('${abbr}')">
            <div class="search-icon">üó∫Ô∏è</div>
            <div class="search-item-info"><div class="search-item-name">${name}</div><div class="search-item-meta">${c.live} live ‚Ä¢ ${c.offline} offline</div></div>
            ${c.live > 0 ? '<div class="search-live-badge">LIVE</div>' : ''}
          </div>`;
        });
      }
      if (clubs.length) {
        html += '<div class="search-category">üè¢ Clubs</div>';
        clubs.slice(0, 5).forEach(cl => {
          html += `<div class="search-item" onclick="selectClub('${cl.name.replace(/'/g, "\\'")}', '${cl.state}')">
            <div class="search-icon">üè¢</div>
            <div class="search-item-info"><div class="search-item-name">${cl.name}</div><div class="search-item-meta">${STATE_NAMES[cl.state]}</div></div>
          </div>`;
        });
      }
      if (streamers.length) {
        html += '<div class="search-category">üë§ Streamers</div>';
        streamers.forEach(s => {
          html += `<div class="search-item" onclick="openStreamerFromSearch('${s.id}')">
            <div class="search-icon">üë§</div>
            <div class="search-item-info"><div class="search-item-name">${s.name}</div><div class="search-item-meta">${s.club}, ${STATE_NAMES[s.state]}</div></div>
            ${s.isLive ? '<div class="search-live-badge">LIVE</div>' : ''}
          </div>`;
        });
      }
      if (!html) html = '<div class="no-results">No results found</div>';
      searchResults.innerHTML = html;
      searchResults.classList.add('visible');
    });

    document.addEventListener('click', (e) => {
      if (!e.target.closest('.search-container')) searchResults.classList.remove('visible');
    });

    function selectState(abbr) { searchBar.value = ''; searchResults.classList.remove('visible'); openState(abbr); }
    function selectClub(name, st) { searchBar.value = ''; searchResults.classList.remove('visible'); openClub(name, st); }
    function openStreamerFromSearch(id) {
      searchBar.value = ''; searchResults.classList.remove('visible');
      closeBrowseSheets();
      const s = allStreamers.find(x => x.id === id);
      if (s && s.isLive) openRoom(s);
      else if (s) openProfile(s.name, s.avatar, s.color);
    }

    function openState(abbr) {
      const clubs = CLUBS[abbr] || [];
      const c = counts[abbr] || {live:0, offline:0};
      document.getElementById('clubSheetTitle').textContent = STATE_NAMES[abbr];
      document.getElementById('clubSheetSubtitle').textContent = `${clubs.length} clubs ‚Ä¢ ${c.live} live ‚Ä¢ Tap to see streamers`;

      const withStatus = clubs.map((club, i) => ({
        name: club, isLive: i < c.live,
        viewers: i < c.live ? Math.floor(Math.random() * 500) + 50 : 0
      }));

      document.getElementById('clubSheetContent').innerHTML = withStatus.map(club => `
        <div class="sheet-item ${club.isLive ? 'live' : ''}" onclick="openClub('${club.name.replace(/'/g, "\\'")}', '${abbr}')">
          <div>
            <div class="item-name ${club.isLive ? 'live' : ''}">${club.name}</div>
            ${!club.isLive ? '<div class="item-status">Offline</div>' : ''}
          </div>
          ${club.isLive ? `<div class="live-badge"><div class="pulse-dot"></div><span>${club.viewers} watching</span></div>` : ''}
        </div>
      `).join('');

      document.getElementById('browseOverlay').classList.add('visible');
      document.getElementById('clubSheet').classList.add('open');
    }

    function openClub(clubName, stateAbbr) {
      const streamers = generateStreamers(clubName, stateAbbr);
      const live = streamers.filter(s => s.isLive);
      const offline = streamers.filter(s => !s.isLive);

      document.getElementById('streamerSheetTitle').textContent = clubName;
      document.getElementById('streamerSheetSubtitle').textContent = `${STATE_NAMES[stateAbbr]} ‚Ä¢ ${live.length} live ‚Ä¢ ${offline.length} offline`;

      let html = '';
      if (live.length) {
        html += `<div class="section-header live">üî¥ LIVE NOW (${live.length})</div>`;
        html += live.map(s => `
          <div class="sheet-item live" onclick="enterRoom('${s.id}', '${s.name.replace(/'/g, "\\'")}', '${s.avatar}', '${s.color}', ${s.viewers}, '${s.title.replace(/'/g, "\\'")}')">
            <div class="streamer-item">
              <div class="streamer-avatar" style="background:${s.color}">${s.avatar}</div>
              <div class="streamer-info"><div class="streamer-name live">${s.name}</div><div class="streamer-viewers">üëÅÔ∏è ${s.viewers} watching</div></div>
            </div>
            <div class="streamer-icon" style="color:#ff1744;">‚ñ∂</div>
          </div>`).join('');
      }
      if (offline.length) {
        html += `<div class="section-header offline">‚ö´ OFFLINE (${offline.length})</div>`;
        html += offline.map(s => `
          <div class="sheet-item" onclick="enterProfile('${s.name.replace(/'/g, "\\'")}', '${s.avatar}', '${s.color}')" style="opacity:0.7;">
            <div class="streamer-item">
              <div class="streamer-avatar offline" style="background:${s.color}">${s.avatar}</div>
              <div class="streamer-info"><div class="streamer-name offline">${s.name}</div><div class="streamer-viewers" style="color:#666;">Tap to view profile</div></div>
            </div>
            <div class="streamer-icon" style="color:#666;">üë§</div>
          </div>`).join('');
      }

      document.getElementById('streamerSheetContent').innerHTML = html;
      document.getElementById('clubSheet').classList.remove('open');
      document.getElementById('streamerSheet').classList.add('open');
    }

    function enterRoom(id, name, avatar, color, viewers, title) {
      closeBrowseSheets();
      openRoom({ id, name, avatar, color, viewers, title });
    }

    function enterProfile(name, avatar, color) {
      closeBrowseSheets();
      openProfile(name, avatar, color);
    }

    document.getElementById('backBtn').onclick = () => {
      document.getElementById('streamerSheet').classList.remove('open');
      document.getElementById('clubSheet').classList.add('open');
    };

    document.getElementById('browseOverlay').onclick = () => closeBrowseSheets();

    function closeBrowseSheets() {
      document.getElementById('browseOverlay').classList.remove('visible');
      document.getElementById('clubSheet').classList.remove('open');
      document.getElementById('streamerSheet').classList.remove('open');
    }

    // ============================================
    // ROOM FUNCTIONS
    // ============================================
    function openRoom(streamer) {
      currentStreamer = streamer;
      document.getElementById('roomAvatar').innerHTML = streamer.avatar;
      document.getElementById('roomAvatar').style.background = streamer.color;
      document.getElementById('roomName').textContent = streamer.name;
      document.getElementById('roomTitle').textContent = streamer.title || 'Live now!';
      document.getElementById('roomViewers').textContent = `üëÅÔ∏è ${(streamer.viewers || 0).toLocaleString()}`;

      const tipButtons = db.getTipButtons();
      document.getElementById('tipButtons').innerHTML = tipButtons.map(tip => `
        <button class="tip-btn" onclick="sendTip(${tip.amount}, '${tip.icon} ${tip.label}')">
          <div class="tip-label">${tip.icon} ${tip.label}</div>
          <div class="tip-amount">ü™ô ${tip.amount}</div>
        </button>`).join('');

      const levels = db.getLovenseLevels();
      document.getElementById('lovenseContent').innerHTML = levels.map(l => `
        <div class="lovense-item" onclick="activateLovense('${l.label}', ${l.tokens}, ${l.duration})">
          <span class="lovense-label">${l.icon} ${l.label}</span>
          <div style="display:flex;flex-direction:column;align-items:flex-end;gap:2px;">
            <span class="lovense-cost">ü™ô ${l.tokens}</span>
            <span class="lovense-duration">${l.duration}s</span>
          </div>
        </div>`).join('');

      renderChat();
      showPage('room');
    }

    function leaveRoom() {
      if (isInPrivateShow) {
        if (!confirm('Leave private show? Time will be lost.')) return;
        endPrivateShow();
      }
      showPage('browse');
    }

    function sendTip(amount, label) {
      const balance = db.getBalance();
      if (balance < amount) { alert('Not enough tokens!'); return; }
      db.deductTokens(amount, 'tip');
      updateBalance();
      chatHistory.unshift({ type: 'tip', user: 'you', text: label, amount });
      renderChat();
    }

    function activateLovense(label, tokens, duration) {
      const balance = db.getBalance();
      if (balance < tokens) { alert('Not enough tokens!'); return; }
      db.deductTokens(tokens, 'lovense');
      updateBalance();
      chatHistory.unshift({ type: 'lovense', user: 'you', text: `${label} (${duration}s)`, amount: tokens });
      renderChat();
      closeLovense();
    }

    function renderChat() {
      const chat = document.getElementById('chatMessages');
      chat.innerHTML = chatHistory.slice(0, 10).map(msg => {
        if (msg.type === 'tip' && msg.amount) {
          return `<div class="chat-msg"><span class="chat-user">${msg.user}</span><span>${msg.text}</span><span class="chat-tip-amount">ü™ô ${msg.amount}</span></div>`;
        }
        if (msg.type === 'lovense') {
          return `<div class="chat-msg chat-msg-lovense"><span class="chat-user chat-user-pink">${msg.user}</span><span>activated ${msg.text}</span><span class="chat-tip-amount chat-tip-pink">ü™ô ${msg.amount}</span></div>`;
        }
        return `<div class="chat-msg">${msg.text}</div>`;
      }).join('');
    }

    function buyPackage(tokens) {
      db.addTokens(tokens);
      updateBalance();
      alert(`Added ${tokens} tokens!`);
    }

    function updateBalance() {
      const balance = db.getBalance();
      document.getElementById('tokenBadge').textContent = `ü™ô ${balance.toLocaleString()}`;
    }

    function renderPackages() {
      const icons = ['üí∞','‚≠ê','üíé','üêã'];
      document.getElementById('packageGrid').innerHTML = PACKAGES.map((p, i) => `
        <div class="package-card ${p.popular ? 'popular' : ''}">
          ${p.popular ? '<div class="popular-badge">‚≠ê MOST POPULAR</div>' : ''}
          <div class="package-icon">${icons[i]}</div>
          <div class="package-name">${p.name}</div>
          <div class="package-tokens">${p.tokens.toLocaleString()}</div>
          <div class="package-label">tokens</div>
          <button class="buy-btn ${p.popular ? 'popular' : ''}" onclick="buyPackage(${p.tokens})">BUY $${p.price}</button>
        </div>`).join('');
    }

    // ============================================
    // NAVIGATION
    // ============================================
    function showPage(page) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

      const floating = document.getElementById('floatingPrivateBtn');
      floating.style.display = 'none';

      if (page === 'browse') {
        document.getElementById('browsePage').classList.add('active');
        document.querySelectorAll('.nav-item')[0].classList.add('active');
      } else if (page === 'room') {
        document.getElementById('roomPage').classList.add('active');
        floating.style.display = 'block';
      } else if (page === 'profile') {
        document.getElementById('profilePage').classList.add('active');
      } else if (page === 'tokens') {
        document.getElementById('tokensPage').classList.add('active');
        document.querySelectorAll('.nav-item')[1].classList.add('active');
      } else if (page === 'dashboard') {
        document.getElementById('dashboardPage').classList.add('active');
        document.querySelectorAll('.nav-item')[2].classList.add('active');
      }
    }

    // ============================================
    // SHEETS
    // ============================================
    function openLovense() {
      document.getElementById('lovenseOverlay').classList.add('visible');
      document.getElementById('lovenseSheet').classList.add('open');
    }
    function closeLovense() {
      document.getElementById('lovenseOverlay').classList.remove('visible');
      document.getElementById('lovenseSheet').classList.remove('open');
    }
    function openPrivateSheet() {
      document.getElementById('privateOverlay').classList.add('visible');
      document.getElementById('privateSheet').classList.add('open');
    }
    function closePrivateSheet() {
      document.getElementById('privateOverlay').classList.remove('visible');
      document.getElementById('privateSheet').classList.remove('open');
    }
    function closeMoreTimeSheet() {
      document.getElementById('moreTimeOverlay').classList.remove('visible');
      document.getElementById('moreTimeSheet').classList.remove('open');
    }

    // ============================================
    // PRIVATE SHOW (single, clean implementation)
    // ============================================
    function startPrivateShow() {
      const settings = db.getPrivateShowSettings();
      const balance = db.getBalance();
      const cost = settings.tokensPerMin * settings.minDuration;

      if (balance < cost) {
        alert('Not enough tokens!\n\nPrivate show costs ' + cost + ' tokens (' + settings.minDuration + ' minutes).\nYour balance: ' + balance + ' tokens\n\nVisit the Wallet to buy more tokens.');
        closePrivateSheet();
        showPage('tokens');
        return;
      }

      db.deductTokens(cost, 'private-show');
      updateBalance();
      closePrivateSheet();

      isInPrivateShow = true;
      privateShowTimeRemaining = settings.minDuration * 60;

      document.getElementById('privateTimer').style.display = 'block';
      document.getElementById('moreTimeBtn').style.display = 'block';

      updateTimerDisplay();
      privateShowTimer = setInterval(() => {
        privateShowTimeRemaining--;
        updateTimerDisplay();
        if (privateShowTimeRemaining <= 0) endPrivateShow();
      }, 1000);

      chatHistory.unshift({ type: 'system', text: 'üîí Private show started! ' + settings.minDuration + ' minutes ‚Ä¢ Room is now private' });
      renderChat();
      alert('üîí Private Show Started!\n\n‚ú® Exclusive access\n‚è±Ô∏è ' + settings.minDuration + ' minutes\nüí∞ ' + cost + ' tokens');
    }

    function updateTimerDisplay() {
      const m = Math.floor(privateShowTimeRemaining / 60);
      const s = privateShowTimeRemaining % 60;
      const display = m + ':' + (s < 10 ? '0' : '') + s;
      document.getElementById('timerDisplay').textContent = display;
      document.getElementById('moreTimeCurrentTimer').textContent = display;
    }

    function endPrivateShow() {
      clearInterval(privateShowTimer);
      isInPrivateShow = false;
      privateShowTimeRemaining = 0;
      document.getElementById('privateTimer').style.display = 'none';
      document.getElementById('moreTimeBtn').style.display = 'none';
      chatHistory.unshift({ type: 'system', text: '‚è∞ Private show ended. Thank you!' });
      renderChat();
      alert('‚è∞ Private Show Ended\n\nThank you!');
    }

    function showMoreTimeOptions() {
      const settings = db.getPrivateShowSettings();
      document.getElementById('extensionOptions').innerHTML = settings.extensions.map((ext, i) => `
        <div class="extension-option" onclick="addMoreTime(${i})">
          <div class="flex-between">
            <div>
              <div class="text-xl font-black text-gold mb-4">+${ext.minutes} Minutes</div>
              <div class="text-sm text-muted">Extend your private show</div>
            </div>
            <div style="text-align:right;">
              <div class="text-3xl font-black text-white">${ext.tokens}</div>
              <div class="text-xs text-muted">tokens</div>
            </div>
          </div>
        </div>`).join('');
      document.getElementById('moreTimeOverlay').classList.add('visible');
      document.getElementById('moreTimeSheet').classList.add('open');
    }

    function addMoreTime(index) {
      const settings = db.getPrivateShowSettings();
      const ext = settings.extensions[index];
      const balance = db.getBalance();
      if (balance < ext.tokens) {
        alert('Not enough tokens!\n\n' + ext.tokens + ' tokens needed.\nYour balance: ' + balance);
        closeMoreTimeSheet(); return;
      }
      db.deductTokens(ext.tokens, 'private-extension');
      updateBalance();
      privateShowTimeRemaining += (ext.minutes * 60);
      updateTimerDisplay();
      closeMoreTimeSheet();
      chatHistory.unshift({ type: 'system', text: '‚è±Ô∏è +' + ext.minutes + ' minutes added! (' + ext.tokens + ' tokens)' });
      renderChat();
      alert('‚úÖ +' + ext.minutes + ' minutes added!');
    }

    function joinSpyMode() {
      alert('üëÅÔ∏è Spy Mode\n\nNo private shows currently available to spy on.');
      closePrivateSheet();
    }

    // ============================================
    // DASHBOARD FUNCTIONS
    // ============================================
    function savePrivateSettings() {
      const settings = {
        tokensPerMin: parseInt(document.getElementById('tokensPerMin').value),
        minDuration: parseInt(document.getElementById('minDuration').value),
        extensions: [
          { minutes: parseInt(document.getElementById('ext1Minutes').value), tokens: parseInt(document.getElementById('ext1Tokens').value) },
          { minutes: parseInt(document.getElementById('ext2Minutes').value), tokens: parseInt(document.getElementById('ext2Tokens').value) },
          { minutes: parseInt(document.getElementById('ext3Minutes').value), tokens: parseInt(document.getElementById('ext3Tokens').value) }
        ]
      };
      db.savePrivateShowSettings(settings);
      updatePrivateShowUI();
      updateDashboardPreview();
      alert('‚úÖ Private show settings saved!');
    }

    function updatePrivateShowUI() {
      const s = db.getPrivateShowSettings();
      const el = document.querySelector('.floating-btn-price');
      if (el) el.textContent = '$' + (s.tokensPerMin / 10).toFixed(0) + '/min';
    }

    function updateDashboardPreview() {
      const s = db.getPrivateShowSettings();
      const price = (s.tokensPerMin / 10).toFixed(0);
      const minCost = s.tokensPerMin * s.minDuration;
      document.getElementById('previewPrice').textContent = price;
      document.getElementById('previewMinCost').textContent = minCost;
      document.getElementById('previewMinCostUSD').textContent = (minCost / 10).toFixed(0);
      document.getElementById('previewExt1Min').textContent = s.extensions[0].minutes;
      document.getElementById('previewExt1Tokens').textContent = s.extensions[0].tokens;
      document.getElementById('previewExt2Min').textContent = s.extensions[1].minutes;
      document.getElementById('previewExt2Tokens').textContent = s.extensions[1].tokens;
      document.getElementById('previewExt3Min').textContent = s.extensions[2].minutes;
      document.getElementById('previewExt3Tokens').textContent = s.extensions[2].tokens;
    }

    function setupDashboardListeners() {
      ['tokensPerMin','minDuration','ext1Minutes','ext1Tokens','ext2Minutes','ext2Tokens','ext3Minutes','ext3Tokens'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', () => {
          const temp = {
            tokensPerMin: parseInt(document.getElementById('tokensPerMin').value),
            minDuration: parseInt(document.getElementById('minDuration').value),
            extensions: [
              { minutes: parseInt(document.getElementById('ext1Minutes').value), tokens: parseInt(document.getElementById('ext1Tokens').value) },
              { minutes: parseInt(document.getElementById('ext2Minutes').value), tokens: parseInt(document.getElementById('ext2Tokens').value) },
              { minutes: parseInt(document.getElementById('ext3Minutes').value), tokens: parseInt(document.getElementById('ext3Tokens').value) }
            ]
          };
          document.getElementById('previewPrice').textContent = (temp.tokensPerMin / 10).toFixed(0);
          const mc = temp.tokensPerMin * temp.minDuration;
          document.getElementById('previewMinCost').textContent = mc;
          document.getElementById('previewMinCostUSD').textContent = (mc / 10).toFixed(0);
          document.getElementById('previewExt1Min').textContent = temp.extensions[0].minutes;
          document.getElementById('previewExt1Tokens').textContent = temp.extensions[0].tokens;
          document.getElementById('previewExt2Min').textContent = temp.extensions[1].minutes;
          document.getElementById('previewExt2Tokens').textContent = temp.extensions[1].tokens;
          document.getElementById('previewExt3Min').textContent = temp.extensions[2].minutes;
          document.getElementById('previewExt3Tokens').textContent = temp.extensions[2].tokens;
        });
      });
    }

    // Lovense Dashboard
    function renderLovenseLevelsList() {
      const list = document.getElementById('lovenseLevelsList');
      const countEl = document.getElementById('lovenseLevelCount');
      const warn = document.getElementById('lovenseMaxWarning');
      const form = document.getElementById('lovenseAddForm');
      const levels = db.getLovenseLevels();

      countEl.textContent = levels.length + '/5';
      warn.style.display = levels.length >= 5 ? 'block' : 'none';
      form.style.display = levels.length >= 5 ? 'none' : 'block';

      list.innerHTML = levels.map(l => `
        <div class="lovense-level-item">
          <div style="flex:1;">
            <div class="text-lg font-bold text-white mb-4">${l.icon} ${l.label}</div>
            <div class="text-sm text-muted">${l.tokens} tokens ‚Ä¢ ${l.duration}s</div>
          </div>
          <button class="btn-delete" onclick="deleteLovenseLevel(${l.id})">‚úï</button>
        </div>`).join('');
    }

    function addLovenseLevel() {
      const levels = db.getLovenseLevels();
      if (levels.length >= 5) { alert('‚ö†Ô∏è Maximum 5 levels!'); return; }
      const icon = document.getElementById('newLovenseIcon').value;
      const label = document.getElementById('newLovenseLabel').value.trim();
      const tokens = parseInt(document.getElementById('newLovenseTokens').value);
      const duration = parseInt(document.getElementById('newLovenseDuration').value);
      if (!label) { alert('‚ö†Ô∏è Please enter a label.'); return; }
      if (tokens < 1 || tokens > 1000) { alert('‚ö†Ô∏è Tokens: 1-1000.'); return; }
      if (duration < 1 || duration > 300) { alert('‚ö†Ô∏è Duration: 1-300 seconds.'); return; }
      levels.push({ id: Date.now(), icon, label, tokens, duration });
      db.saveLovenseLevels(levels);
      document.getElementById('newLovenseLabel').value = '';
      document.getElementById('newLovenseTokens').value = '15';
      document.getElementById('newLovenseDuration').value = '10';
      document.getElementById('newLovenseIcon').value = 'üíó';
      renderLovenseLevelsList();
      alert('‚úÖ Level added! ' + icon + ' ' + label);
    }

    function deleteLovenseLevel(id) {
      const levels = db.getLovenseLevels();
      const level = levels.find(l => l.id === id);
      if (!level) return;
      if (confirm('Delete ' + level.icon + ' ' + level.label + '?')) {
        db.saveLovenseLevels(levels.filter(l => l.id !== id));
        renderLovenseLevelsList();
      }
    }

    // Tip Button Dashboard
    function renderTipButtonEditors() {
      const container = document.getElementById('tipButtonEditors');
      const buttons = db.getTipButtons();
      const icons = ['üéÅ','üíñ','üíù','üíé','üëë','üåü','‚ú®','üí∞','üî•','‚ö°','üí•','üêã','üéÜ','üéâ','üçæ','üèÜ'];

      container.innerHTML = buttons.map((btn, i) => `
        <div class="config-card">
          <div class="text-red font-black text-base mb-12">Button ${i + 1}</div>
          <div class="form-group">
            <label class="form-label">Icon</label>
            <select id="tipIcon${i}" onchange="updateTipPreview()" class="form-select">
              ${icons.map(ic => `<option value="${ic}" ${btn.icon === ic ? 'selected' : ''}>${ic}</option>`).join('')}
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Label</label>
            <input type="text" id="tipLabel${i}" value="${btn.label}" maxlength="20" onkeyup="updateTipPreview()" class="form-input" style="border-color:#ff1744;" placeholder="e.g., Small, Big, Whale">
          </div>
          <div>
            <label class="form-label">Tokens</label>
            <input type="number" id="tipAmount${i}" value="${btn.amount}" min="1" max="10000" onkeyup="updateTipPreview()" class="form-input" style="border-color:#ff1744;">
          </div>
        </div>`).join('');
    }

    function updateTipPreview() {
      for (let i = 0; i < 4; i++) {
        const icon = document.getElementById('tipIcon' + i).value;
        const label = document.getElementById('tipLabel' + i).value || 'Button ' + (i + 1);
        const amount = document.getElementById('tipAmount' + i).value || '0';
        const preview = document.getElementById('tipPreview' + (i + 1));
        preview.querySelector('.tip-label').textContent = icon + ' ' + label;
        preview.querySelector('.tip-amount').textContent = 'ü™ô ' + amount;
      }
    }

    function saveTipButtons() {
      for (let i = 0; i < 4; i++) {
        if (!document.getElementById('tipLabel' + i).value.trim()) { alert('‚ö†Ô∏è Button ' + (i+1) + ' needs a label!'); return; }
        const amt = parseInt(document.getElementById('tipAmount' + i).value);
        if (amt < 1 || amt > 10000) { alert('‚ö†Ô∏è Button ' + (i+1) + ' tokens: 1-10,000!'); return; }
      }
      const newBtns = [];
      for (let i = 0; i < 4; i++) {
        newBtns.push({
          icon: document.getElementById('tipIcon' + i).value,
          label: document.getElementById('tipLabel' + i).value.trim(),
          amount: parseInt(document.getElementById('tipAmount' + i).value)
        });
      }
      db.saveTipButtons(newBtns);
      alert('‚úÖ Tip buttons saved!');
    }

    // Schedule Dashboard
    function renderOnlineSchedule() {
      const list = document.getElementById('onlineScheduleList');
      const schedule = db.getOnlineSchedule();
      if (!schedule.length) { list.innerHTML = '<div class="empty-state">No online hours set</div>'; return; }
      list.innerHTML = schedule.map(s => `
        <div class="schedule-item schedule-item-online">
          <div><div class="text-base font-bold text-white mb-4">${s.day}</div><div class="text-sm text-gold">${s.startTime} - ${s.endTime}</div></div>
          <button class="btn-delete-sm" onclick="deleteOnlineSchedule(${s.id})">‚úï</button>
        </div>`).join('');
    }

    function renderLiveSchedule() {
      const list = document.getElementById('liveScheduleList');
      const schedule = db.getLiveSchedule();
      if (!schedule.length) { list.innerHTML = '<div class="empty-state">No live hours set</div>'; return; }
      list.innerHTML = schedule.map(s => `
        <div class="schedule-item schedule-item-live">
          <div><div class="text-base font-bold text-white mb-4">${s.day}</div><div class="text-sm text-red">${s.startTime} - ${s.endTime}</div></div>
          <button class="btn-delete-sm" onclick="deleteLiveSchedule(${s.id})">‚úï</button>
        </div>`).join('');
    }

    function addOnlineSchedule() {
      const days = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
      const day = prompt('Select day:\n\n' + days.map((d,i) => (i+1) + '. ' + d).join('\n'));
      if (!day || day < 1 || day > 7) return;
      const dayName = days[parseInt(day) - 1];
      const start = prompt('Start time (HH:MM):\nExample: 18:00');
      if (!start || !start.match(/^\d{2}:\d{2}$/)) { alert('Invalid format. Use HH:MM'); return; }
      const end = prompt('End time (HH:MM):\nExample: 23:00');
      if (!end || !end.match(/^\d{2}:\d{2}$/)) { alert('Invalid format. Use HH:MM'); return; }
      const schedule = db.getOnlineSchedule();
      schedule.push({ id: Date.now(), day: dayName, startTime: start, endTime: end });
      db.saveOnlineSchedule(schedule);
      renderOnlineSchedule();
      alert('‚úÖ Added: ' + dayName + ' ' + start + '-' + end);
    }

    function addLiveSchedule() {
      const days = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
      const day = prompt('Select day:\n\n' + days.map((d,i) => (i+1) + '. ' + d).join('\n'));
      if (!day || day < 1 || day > 7) return;
      const dayName = days[parseInt(day) - 1];
      const start = prompt('Start time (HH:MM):\nExample: 20:00');
      if (!start || !start.match(/^\d{2}:\d{2}$/)) { alert('Invalid format. Use HH:MM'); return; }
      const end = prompt('End time (HH:MM):\nExample: 22:00');
      if (!end || !end.match(/^\d{2}:\d{2}$/)) { alert('Invalid format. Use HH:MM'); return; }
      const schedule = db.getLiveSchedule();
      schedule.push({ id: Date.now(), day: dayName, startTime: start, endTime: end });
      db.saveLiveSchedule(schedule);
      renderLiveSchedule();
      alert('‚úÖ Added: ' + dayName + ' ' + start + '-' + end);
    }

    function deleteOnlineSchedule(id) {
      const schedule = db.getOnlineSchedule();
      const slot = schedule.find(s => s.id === id);
      if (!slot) return;
      if (confirm('Delete ' + slot.day + ' ' + slot.startTime + '-' + slot.endTime + '?')) {
        db.saveOnlineSchedule(schedule.filter(s => s.id !== id));
        renderOnlineSchedule();
      }
    }

    function deleteLiveSchedule(id) {
      const schedule = db.getLiveSchedule();
      const slot = schedule.find(s => s.id === id);
      if (!slot) return;
      if (confirm('Delete ' + slot.day + ' ' + slot.startTime + '-' + slot.endTime + '?')) {
        db.saveLiveSchedule(schedule.filter(s => s.id !== id));
        renderLiveSchedule();
      }
    }

    // ============================================
    // PROFILE PAGE
    // ============================================
    function openProfile(name, avatar, color) {
      currentProfile = { name, avatar, color };
      document.getElementById('profileAvatar').innerHTML = avatar;
      document.getElementById('profileAvatar').style.background = color;
      document.getElementById('profileName').textContent = name;

      const onSched = db.getOnlineSchedule();
      const onDiv = document.getElementById('profileOnlineSchedule');
      onDiv.innerHTML = onSched.length ? onSched.map(s => `
        <div class="profile-schedule-item profile-schedule-online">
          <span class="text-md font-bold text-white">${s.day}</span>
          <span class="text-sm text-gold">${s.startTime} - ${s.endTime}</span>
        </div>`).join('') : '<div class="text-dim text-md">No online hours set</div>';

      const liveSched = db.getLiveSchedule();
      const liveDiv = document.getElementById('profileLiveSchedule');
      liveDiv.innerHTML = liveSched.length ? liveSched.map(s => `
        <div class="profile-schedule-item profile-schedule-live">
          <span class="text-md font-bold text-white">${s.day}</span>
          <span class="text-sm text-red">${s.startTime} - ${s.endTime}</span>
        </div>`).join('') : '<div class="text-dim text-md">No live hours set</div>';

      showPage('profile');
    }

    function bookPrivateShow() {
      alert('üìÖ Book Private Show\n\n' + currentProfile.name + '\n\nFeature coming soon!');
    }

    function sendMessage() {
      alert('üíå Send Message\n\n' + currentProfile.name + '\n\nFeature coming soon!');
    }

    // ============================================
    // INIT
    // ============================================
    initBrowse();
    renderPackages();
    updateBalance();
    setupDashboardListeners();
    renderLovenseLevelsList();
    renderTipButtonEditors();
    renderOnlineSchedule();
    renderLiveSchedule();
    updatePrivateShowUI();

    // Load persisted dashboard settings into form fields
    (function loadDashboardSettings() {
      const ps = db.getPrivateShowSettings();
      const el = (id) => document.getElementById(id);
      if (el('tokensPerMin')) el('tokensPerMin').value = ps.tokensPerMin;
      if (el('minDuration')) el('minDuration').value = ps.minDuration;
      if (ps.extensions && ps.extensions.length >= 3) {
        if (el('ext1Minutes')) el('ext1Minutes').value = ps.extensions[0].minutes;
        if (el('ext1Tokens')) el('ext1Tokens').value = ps.extensions[0].tokens;
        if (el('ext2Minutes')) el('ext2Minutes').value = ps.extensions[1].minutes;
        if (el('ext2Tokens')) el('ext2Tokens').value = ps.extensions[1].tokens;
        if (el('ext3Minutes')) el('ext3Minutes').value = ps.extensions[2].minutes;
        if (el('ext3Tokens')) el('ext3Tokens').value = ps.extensions[2].tokens;
      }
      updateDashboardPreview();
    })();

    // Refresh browse stats periodically
    setInterval(() => {
      Object.keys(CLUBS).forEach(state => {
        const clubCount = CLUBS[state].length;
        counts[state] = {
          live: Math.floor(Math.random() * Math.min(clubCount, 8)),
          offline: Math.floor(Math.random() * Math.min(clubCount * 2, 15))
        };
      });
      renderStateGrid();
      updateBrowseStats();
    }, 15000);

  </script>
</body>
</html>