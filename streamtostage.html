<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
  <meta name="theme-color" content="#0a0a0a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>StreamToStage ‚Äî Watch Live, Visit Real</title>
  <style>
    :root {
      --bg: #0a0a0a;
      --surface: #151515;
      --surface2: #1e1e1e;
      --border: #2a2020;
      --accent: #e11d48;
      --accent-glow: rgba(225,29,72,0.35);
      --hot: #ff6b2c;
      --hot-glow: rgba(255,107,44,0.3);
      --cyan: #06b6d4;
      --gold: #f59e0b;
      --gold-glow: rgba(245,158,11,0.35);
      --red: #ef4444;
      --muted: #a8a0a0;
      --dim: #6b6060;
      --white: #f5f0f0;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg); color: var(--white);
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* ===== LAYOUT ===== */
    .top-header {
      position: sticky; top: 0;
      padding: calc(10px + var(--safe-top)) 16px 10px;
      background: rgba(10,10,10,0.95);
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--accent);
      display: flex; justify-content: space-between; align-items: center;
      z-index: 100;
    }
    .brand { display: flex; align-items: center; gap: 8px; }
    .brand-logo {
      width: 32px; height: 32px; border-radius: 8px;
      background: linear-gradient(135deg, var(--accent), var(--hot));
      display: flex; align-items: center; justify-content: center;
      font-size: 14px; font-weight: 900; color: #fff;
    }
    .brand-name { font-size: 17px; font-weight: 800; }
    .brand-name span { color: var(--accent); }
    .token-badge {
      background: var(--surface); border: 1.5px solid var(--gold);
      padding: 6px 14px; border-radius: 20px;
      font-weight: 800; font-size: 14px; color: var(--gold);
    }
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      padding-bottom: var(--safe-bottom);
      background: rgba(10,10,10,0.95);
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      border-top: 1px solid var(--accent);
      display: flex; z-index: 100;
    }
    .nav-item {
      flex: 1; padding: 8px 0; text-align: center;
      background: none; border: none; color: var(--dim);
      font-size: 10px; font-weight: 700; cursor: pointer;
      transition: color 0.2s;
    }
    .nav-item.active { color: var(--accent); }    .nav-item-icon { font-size: 22px; margin-bottom: 2px; }
    .page { display: none; padding-bottom: calc(70px + var(--safe-bottom)); }
    .page.active { display: block; }
    .page-pad { padding: 20px 16px; }

    /* ===== UTILITY ===== */
    .flex-between { display: flex; justify-content: space-between; align-items: center; }
    .flex-center { display: flex; align-items: center; justify-content: center; }
    .flex-col-center { display: flex; flex-direction: column; align-items: center; }
    .flex-gap { display: flex; align-items: center; gap: 8px; }
    .flex-gap-lg { display: flex; align-items: center; gap: 16px; }
    .flex-col-gap { display: flex; flex-direction: column; gap: 6px; }
    .grid-2col { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .mb-4 { margin-bottom: 4px; } .mb-8 { margin-bottom: 8px; }
    .mb-12 { margin-bottom: 12px; } .mb-16 { margin-bottom: 16px; }
    .mb-20 { margin-bottom: 20px; } .mb-24 { margin-bottom: 24px; }
    .mt-8 { margin-top: 8px; } .mt-12 { margin-top: 12px; }
    .mt-16 { margin-top: 16px; } .mt-20 { margin-top: 20px; }
    .text-center { text-align: center; }
    .w-full { width: 100%; }
    .text-muted { color: var(--muted); }
    .text-dim { color: var(--dim); }
    .text-gold { color: var(--gold); }
    .text-red { color: var(--red); }
    .text-pink { color: var(--hot); }
    .text-violet { color: var(--accent); }
    .text-cyan { color: var(--cyan); }
    .text-white { color: var(--white); }
    .text-xs { font-size: 11px; } .text-sm { font-size: 12px; }
    .text-md { font-size: 13px; } .text-base { font-size: 14px; }
    .text-lg { font-size: 16px; } .text-xl { font-size: 18px; }
    .text-2xl { font-size: 20px; } .text-3xl { font-size: 24px; }
    .text-4xl { font-size: 28px; } .text-5xl { font-size: 36px; }
    .font-bold { font-weight: 700; } .font-black { font-weight: 900; }
    .leading-relaxed { line-height: 1.6; }
    .hint { color: var(--dim); font-size: 11px; margin-top: 4px; }

    /* ===== HERO / WELCOME ===== */
    .hero {
      padding: 32px 20px 24px; text-align: center;
      background: linear-gradient(180deg, rgba(225,29,72,0.1) 0%, transparent 100%);
    }
    .hero-badge {
      display: inline-block; padding: 4px 14px; border-radius: 20px;
      background: rgba(225,29,72,0.12); border: 1px solid rgba(225,29,72,0.3);
      font-size: 12px; font-weight: 700; color: var(--accent); margin-bottom: 12px;
    }
    .hero h1 { font-size: 26px; font-weight: 900; line-height: 1.2; margin-bottom: 8px; }
    .hero h1 .accent { background: linear-gradient(135deg, var(--accent), var(--hot)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .hero p { font-size: 14px; color: var(--muted); max-width: 320px; margin: 0 auto; line-height: 1.6; }

    /* ===== HOW IT WORKS ===== */
    .how-it-works { padding: 0 16px 20px; }
    .how-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .how-step {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 14px; padding: 16px 10px; text-align: center;
    }
    .how-icon { font-size: 28px; margin-bottom: 8px; }
    .how-label { font-size: 12px; font-weight: 700; color: var(--white); margin-bottom: 2px; }
    .how-desc { font-size: 10px; color: var(--dim); }

    /* ===== TRENDING STRIP ===== */
    .trending { padding: 0 0 16px; }
    .trending-header { padding: 0 16px 12px; display: flex; align-items: center; gap: 8px; }
    .trending-header h3 { font-size: 16px; font-weight: 800; }
    .trending-scroll { display: flex; gap: 12px; padding: 0 16px; overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none; }
    .trending-scroll::-webkit-scrollbar { display: none; }
    .trending-card {
      flex-shrink: 0; width: 130px; border-radius: 14px; overflow: hidden;
      background: var(--surface); border: 1px solid var(--border);
      cursor: pointer; transition: transform 0.2s;
    }
    .trending-card:active { transform: scale(0.96); }
    .trending-thumb {
      height: 100px; display: flex; align-items: center; justify-content: center;
      font-size: 36px; font-weight: 900; position: relative;
    }
    .trending-live {
      position: absolute; top: 6px; left: 6px;
      background: var(--red); padding: 2px 8px; border-radius: 6px;
      font-size: 9px; font-weight: 900; color: #fff; letter-spacing: 0.5px;
    }
    .trending-info { padding: 10px; }
    .trending-name { font-size: 13px; font-weight: 700; color: var(--white); }
    .trending-viewers { font-size: 11px; color: var(--muted); margin-top: 2px; }
    .trending-club { font-size: 10px; color: var(--dim); margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    /* ===== CARDS ===== */
    .card { border-radius: 14px; padding: 20px; }
    .card-surface { background: var(--surface); border: 1px solid var(--border); }
    .card-violet { background: rgba(225,29,72,0.08); border: 1.5px solid rgba(225,29,72,0.3); }
    .card-pink { background: rgba(255,107,44,0.08); border: 1px solid rgba(255,107,44,0.25); border-radius: 10px; padding: 12px; }
    .card-pink-dashed { background: rgba(255,107,44,0.05); border: 2px dashed rgba(255,107,44,0.3); }
    .card-gold { background: rgba(245,158,11,0.08); border: 1.5px solid rgba(245,158,11,0.3); }
    .card-premium {
      background: linear-gradient(135deg, rgba(225,29,72,0.12), rgba(255,107,44,0.12));
      border: 2px solid var(--accent); border-radius: 16px; padding: 24px;
    }
    .card-spy {
      background: rgba(6,182,212,0.08); border: 1.5px solid rgba(6,182,212,0.3);
      border-radius: 14px; padding: 20px;
    }
    .card-stat {
      background: rgba(0,0,0,0.3); padding: 16px; border-radius: 12px;
      text-align: center; border: 1.5px solid var(--accent);
    }
    .section-divider { border-top: 1px solid var(--border); padding-top: 20px; margin-top: 20px; }
    .section-border-bottom { margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid var(--border); }

    /* ===== FORM ===== */
    .form-group { margin-bottom: 12px; } .form-group-lg { margin-bottom: 20px; }
    .form-label { display: block; color: var(--muted); font-size: 12px; margin-bottom: 6px; }
    .form-label-sm { display: block; color: var(--muted); font-size: 11px; margin-bottom: 4px; }
    .form-label-md { display: block; color: var(--muted); font-size: 13px; margin-bottom: 8px; }
    .form-input {
      width: 100%; background: var(--bg); border: 1px solid var(--border);
      border-radius: 8px; padding: 10px; color: var(--white); font-size: 14px; outline: none;
      transition: border-color 0.2s;
    }
    .form-input:focus { border-color: var(--accent); }
    .form-input-pink { border-color: rgba(255,107,44,0.4); padding: 8px; }
    .form-input-gold { border: 1.5px solid var(--gold); border-radius: 10px; padding: 12px; font-size: 16px; font-weight: 700; }
    .form-select {
      width: 100%; background: var(--bg); border: 1px solid var(--border);
      border-radius: 8px; padding: 10px; color: var(--white); font-size: 16px;
    }

    /* ===== BUTTONS ===== */
    .btn-primary {
      width: 100%; background: linear-gradient(135deg, var(--gold), var(--hot));
      color: #000; padding: 16px; font-size: 16px; font-weight: 800;
      border: none; border-radius: 12px; cursor: pointer;
      box-shadow: 0 4px 16px var(--gold-glow);
    }
    .btn-primary:active { transform: scale(0.97); opacity: 0.9; }
    .btn-save {
      width: 100%; background: linear-gradient(135deg, var(--accent), #b91c1c);
      border: none; color: white; padding: 14px; border-radius: 12px;
      font-size: 15px; font-weight: 800; cursor: pointer;
    }
    .btn-save:active { transform: scale(0.97); }
    .btn-pink {
      background: linear-gradient(135deg, var(--hot), #ea580c);
      color: white; border: none; padding: 12px;
      border-radius: 10px; font-size: 14px; font-weight: 800; cursor: pointer;
    }
    .btn-pink-lg {
      width: 100%; background: linear-gradient(135deg, var(--hot), #ea580c);
      color: white; border: none; padding: 16px;
      border-radius: 12px; font-weight: 800; font-size: 16px; cursor: pointer;
    }
    .btn-pink-lg:active, .btn-pink:active { transform: scale(0.97); }
    .btn-add {
      width: 100%; background: transparent; padding: 12px;
      border-radius: 10px; font-weight: 700; cursor: pointer;
    }
    .btn-add-online { border: 2px dashed rgba(245,158,11,0.4); color: var(--gold); }
    .btn-add-live { border: 2px dashed rgba(239,68,68,0.4); color: var(--red); }
    .btn-delete {
      background: rgba(239,68,68,0.1); border: 1.5px solid var(--red);
      color: var(--red); width: 34px; height: 34px;
      border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: 900;
    }
    .btn-delete-sm { width: 30px; height: 30px; font-size: 14px; border-radius: 6px; background: rgba(239,68,68,0.1); border: 1.5px solid var(--red); color: var(--red); cursor: pointer; }
    .btn-back {
      position: absolute; top: 16px; left: 16px;
      background: rgba(0,0,0,0.5); border: 1.5px solid rgba(255,255,255,0.2);
      color: white; width: 36px; height: 36px;
      border-radius: 50%; font-size: 16px; cursor: pointer;
      backdrop-filter: blur(8px);
    }
    .btn-spy {
      background: linear-gradient(135deg, var(--cyan), #0891b2);
      color: white; border: none;
      padding: 12px 20px; border-radius: 10px; font-weight: 800; cursor: pointer;
    }
    .btn-more-time {
      display: none; width: 90%; margin: 16px auto 0;
      background: linear-gradient(135deg, var(--gold), #d97706);
      color: #000; border: none;
      padding: 14px; border-radius: 12px;
      font-size: 15px; font-weight: 800; cursor: pointer;
      box-shadow: 0 4px 16px var(--gold-glow);
      animation: shimmer 3s infinite;
    }
    @keyframes shimmer {
      0%, 100% { box-shadow: 0 4px 16px var(--gold-glow); }
      50% { box-shadow: 0 4px 24px rgba(245,158,11,0.5); }
    }

    /* ===== BADGES ===== */
    .config-badge {
      padding: 4px 10px; border-radius: 8px; font-weight: 800; font-size: 13px;
    }
    .config-badge-violet { background: rgba(225,29,72,0.15); border: 1px solid rgba(225,29,72,0.3); color: var(--accent); }
    .config-badge-pink { background: rgba(255,107,44,0.12); border: 1px solid rgba(255,107,44,0.25); color: var(--hot); }
    .offline-badge {
      background: rgba(0,0,0,0.3); padding: 4px 12px;
      border-radius: 20px; border: 1px solid var(--border);
    }

    /* ===== BROWSE ===== */
    .search-container { position: relative; padding: 0 16px 12px; }
    .search-bar {
      width: 100%; background: var(--surface);
      border: 1.5px solid var(--border); border-radius: 12px;
      padding: 12px 16px; font-size: 15px; color: var(--white); outline: none;
    }
    .search-bar::placeholder { color: var(--dim); }
    .search-bar:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }
    .search-results {
      position: absolute; top: 100%; left: 16px; right: 16px;
      background: var(--surface); border: 1.5px solid var(--accent);
      border-radius: 12px; max-height: 70vh; overflow-y: auto;
      display: none; z-index: 200;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    }
    .search-results.visible { display: block; }
    .search-category {
      padding: 10px 16px; font-size: 12px; font-weight: 800; text-transform: uppercase;
      color: var(--accent); border-bottom: 1px solid var(--border); letter-spacing: 0.5px;
    }
    .search-item {
      padding: 12px 16px; display: flex; align-items: center; gap: 12px;
      border-bottom: 1px solid var(--border); cursor: pointer;
    }
    .search-item:active { background: rgba(225,29,72,0.08); }
    .search-icon { font-size: 22px; width: 32px; text-align: center; }
    .search-item-info { flex: 1; }
    .search-item-name { font-size: 14px; font-weight: 700; }
    .search-item-meta { font-size: 11px; color: var(--muted); margin-top: 2px; }
    .search-live-badge {
      background: var(--red); color: #fff; font-size: 10px;
      font-weight: 800; padding: 3px 8px; border-radius: 6px;
    }
    .no-results { padding: 20px; text-align: center; color: var(--dim); font-size: 14px; }

    .section-label { padding: 4px 16px 10px; font-size: 15px; font-weight: 800; color: var(--white); }

    .stats-bar {
      display: flex; align-items: center; gap: 14px;
      padding: 8px 16px 10px; 
    }
    .stat { font-size: 12px; font-weight: 700; display: flex; align-items: center; gap: 5px; color: var(--muted); }
    .stat.clubs { margin-left: auto; color: var(--gold); }
    .stat-dot { width: 7px; height: 7px; border-radius: 50%; }

    .state-grid {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; padding: 0 12px 12px;
    }
    .state-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
      padding: 14px; cursor: pointer; transition: all 0.15s;
    }
    .state-card:active { transform: scale(0.97); }
    .state-card.has-live { border-color: rgba(239,68,68,0.4); background: rgba(239,68,68,0.04); }
    .state-name { font-size: 14px; font-weight: 800; margin-bottom: 4px; }
    .state-counts { display: flex; gap: 8px; margin-bottom: 3px; }
    .count-item { font-size: 11px; font-weight: 700; }
    .count-live { color: var(--red); }
    .count-offline { color: var(--dim); }
    .state-clubs { font-size: 10px; color: var(--gold); }

    /* ===== SHEETS ===== */
    .overlay, .sheet-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6); z-index: 150;
      opacity: 0; pointer-events: none; transition: opacity 0.25s;
    }
    .overlay.visible, .sheet-overlay.visible { opacity: 1; pointer-events: auto; }
    .bottom-sheet {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--surface); border-top: 1px solid var(--border);
      border-radius: 20px 20px 0 0; max-height: 85vh;
      overflow-y: auto; z-index: 200;
      transform: translateY(100%); transition: transform 0.3s ease;
      will-change: transform;
      padding-bottom: var(--safe-bottom);
    }
    .bottom-sheet.open { transform: translateY(0); }
    .sheet-handle { width: 36px; height: 4px; background: var(--dim); border-radius: 2px; margin: 10px auto; }
    .sheet-header { padding: 4px 16px 14px; position: relative; }
    .sheet-title { font-size: 18px; font-weight: 800; color: var(--white); }
    .sheet-subtitle { font-size: 12px; color: var(--muted); margin-top: 3px; }
    .sheet-content { padding: 0 16px 20px; }
    .close-btn {
      position: absolute; top: 4px; right: 16px;
      background: none; border: none; color: var(--dim);
      font-size: 22px; cursor: pointer;
    }
    .sheet-item {
      padding: 14px; border-bottom: 1px solid var(--border);
      cursor: pointer; display: flex; justify-content: space-between; align-items: center;
    }
    .sheet-item:active { background: rgba(225,29,72,0.06); }
    .sheet-item.live { border-left: 3px solid var(--red); }
    .item-name { font-size: 15px; font-weight: 700; }
    .item-name.live { color: var(--red); }
    .item-status { font-size: 11px; color: var(--dim); margin-top: 3px; }
    .live-badge {
      display: flex; align-items: center; gap: 5px;
      background: rgba(239,68,68,0.1); padding: 4px 10px;
      border-radius: 8px; border: 1px solid rgba(239,68,68,0.3);
    }
    .live-badge span { font-size: 11px; color: var(--red); font-weight: 700; }
    .pulse-dot {
      width: 7px; height: 7px; border-radius: 50%;
      background: var(--red); animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0.4); }
      50% { box-shadow: 0 0 0 5px rgba(239,68,68,0); }
    }
    .section-header { padding: 10px 16px; font-size: 12px; font-weight: 800; border-bottom: 1px solid var(--border); letter-spacing: 0.5px; }
    .section-header.live { color: var(--red); }
    .section-header.offline { color: var(--dim); }
    .streamer-item { display: flex; align-items: center; gap: 12px; }
    .streamer-avatar {
      width: 42px; height: 42px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 20px; font-weight: 900; border: 2px solid var(--accent);
    }
    .streamer-avatar.offline { filter: grayscale(40%); border-color: var(--dim); }
    .streamer-info { flex: 1; }
    .streamer-name { font-size: 14px; font-weight: 700; }
    .streamer-name.live { color: var(--red); }
    .streamer-name.offline { color: var(--muted); }
    .streamer-viewers { font-size: 11px; color: var(--muted); margin-top: 2px; }
    .back-btn-sheet {
      background: none; border: 1.5px solid var(--border); color: var(--muted);
      padding: 4px 10px; border-radius: 6px; font-size: 14px;
      font-weight: 700; cursor: pointer; margin-right: 12px;
    }

    /* ===== ROOM ===== */
    .video-container {
      background: linear-gradient(180deg, var(--surface) 0%, var(--bg) 100%);
      padding: 24px 16px; text-align: center;
      border-bottom: 1px solid var(--border); position: relative;
    }
    .room-back-btn {
      position: absolute; top: 12px; left: 12px;
      background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.15);
      color: #fff; width: 34px; height: 34px; border-radius: 50%;
      font-size: 15px; cursor: pointer; z-index: 5;
      display: flex; align-items: center; justify-content: center;
      backdrop-filter: blur(6px);
    }
    .room-avatar {
      width: 72px; height: 72px; border-radius: 50%; margin: 0 auto 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 36px; font-weight: 900; border: 2px solid var(--accent);
    }
    .room-name { font-size: 20px; font-weight: 800; margin-bottom: 3px; }
    .room-title { font-size: 13px; color: var(--muted); margin-bottom: 10px; }
    .room-stats { display: flex; gap: 10px; justify-content: center; }
    .stat-badge { padding: 4px 12px; border-radius: 8px; font-size: 12px; font-weight: 800; }
    .stat-live { background: rgba(239,68,68,0.12); color: var(--red); border: 1px solid rgba(239,68,68,0.3); display: flex; align-items: center; }
    .stat-viewers { background: rgba(245,158,11,0.12); color: var(--gold); border: 1px solid rgba(245,158,11,0.3); }
    .room-controls { display: flex; gap: 10px; margin-top: 14px; }
    .control-btn {
      flex: 1; background: linear-gradient(135deg, var(--accent), #b91c1c);
      border: none; color: white;
      font-size: 14px; font-weight: 800; padding: 12px 16px;
      border-radius: 10px; cursor: pointer;
    }
    .control-btn:active { transform: scale(0.96); }
    .control-btn-alt { background: var(--surface2); border: 1px solid var(--border); }
    .private-timer {
      display: none; margin-top: 14px;
      background: rgba(225,29,72,0.1); border: 1.5px solid var(--accent);
      border-radius: 12px; padding: 14px; text-align: center;
    }
    .timer-label { font-size: 11px; color: var(--accent); margin-bottom: 3px; font-weight: 700; letter-spacing: 0.5px; }
    .timer-display { font-size: 30px; font-weight: 900; color: var(--white); font-family: monospace; }
    .timer-sub { font-size: 10px; color: var(--muted); margin-top: 3px; }

    .tip-section { display: flex; gap: 10px; padding: 12px; overflow-x: auto; scrollbar-width: none; }
    .tip-section::-webkit-scrollbar { display: none; }
    .tip-btn {
      background: var(--surface); border: 1.5px solid var(--border); border-radius: 12px;
      padding: 10px 14px; text-align: center; min-width: 90px;
      cursor: pointer; transition: all 0.15s; flex-shrink: 0;
    }
    .tip-btn:active { transform: scale(0.95); border-color: var(--accent); background: rgba(225,29,72,0.08); }
    .tip-label { font-size: 13px; font-weight: 800; margin-bottom: 3px; }
    .tip-amount { font-size: 12px; color: var(--gold); font-weight: 700; }

    .chat-section { padding: 0 12px; }
    .chat-title { font-size: 13px; font-weight: 800; color: var(--muted); padding: 10px 4px 6px; letter-spacing: 0.3px; }
    .chat-messages { max-height: 300px; overflow-y: auto; }
    .chat-msg {
      padding: 8px 10px; margin-bottom: 4px;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 8px; font-size: 13px;
      display: flex; align-items: center; gap: 8px;
    }
    .chat-msg-lovense { border-color: rgba(255,107,44,0.25); background: rgba(255,107,44,0.06); }
    .chat-user { color: var(--accent); font-weight: 800; font-size: 12px; }
    .chat-user-pink { color: var(--hot); }
    .chat-tip-amount { margin-left: auto; font-weight: 800; color: var(--gold); font-size: 16px; }
    .chat-tip-pink { color: var(--hot); }

    .lovense-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 14px; border-bottom: 1px solid var(--border); cursor: pointer;
    }
    .lovense-item:active { background: rgba(255,107,44,0.06); }
    .lovense-label { font-size: 15px; font-weight: 700; }
    .lovense-cost { font-size: 14px; font-weight: 800; color: var(--gold); }
    .lovense-duration { font-size: 10px; color: var(--muted); }

    .floating-private-btn {
      position: fixed; right: 12px; bottom: calc(72px + var(--safe-bottom));
      background: linear-gradient(135deg, var(--accent), #b91c1c);
      border: 2px solid var(--gold); border-radius: 50px;
      padding: 10px 14px; color: #fff;
      box-shadow: 0 4px 20px var(--accent-glow);
      cursor: pointer; z-index: 90; text-align: center;
      display: none;
    }
    .floating-private-btn:active { transform: scale(0.95); }
    .floating-btn-icon { font-size: 18px; }
    .floating-btn-text { font-size: 9px; font-weight: 800; letter-spacing: 1px; }
    .floating-btn-price { font-size: 10px; font-weight: 700; }

    /* ===== PACKAGES ===== */
    .package-grid { display: grid; gap: 14px; padding: 0 16px 16px; }
    .package-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 14px; padding: 20px; position: relative;
    }
    .package-card.popular { border: 2px solid var(--gold); box-shadow: 0 4px 20px var(--gold-glow); }
    .popular-badge {
      position: absolute; top: -10px; left: 16px;
      background: linear-gradient(135deg, var(--gold), var(--hot));
      padding: 4px 14px; border-radius: 10px; font-size: 11px;
      font-weight: 800; color: #000;
    }
    .package-icon { font-size: 40px; margin-bottom: 6px; }
    .package-name { font-size: 18px; font-weight: 800; margin-bottom: 3px; color: var(--accent); }
    .package-tokens { font-size: 32px; font-weight: 900; color: var(--gold); margin-bottom: 3px; }
    .package-label { font-size: 12px; color: var(--muted); margin-bottom: 14px; }
    .buy-btn {
      width: 100%; background: linear-gradient(135deg, var(--hot), #ea580c);
      color: #fff; padding: 14px; border-radius: 10px; font-size: 16px;
      font-weight: 800; border: none; cursor: pointer;
      box-shadow: 0 4px 12px var(--hot-glow);
    }
    .buy-btn:active { transform: scale(0.97); }
    .buy-btn.popular { background: linear-gradient(135deg, var(--gold), var(--hot)); box-shadow: 0 4px 16px var(--gold-glow); }

    /* ===== DASHBOARD ===== */
    .lovense-level-item {
      background: rgba(255,107,44,0.06); border: 1px solid rgba(255,107,44,0.2);
      border-radius: 10px; padding: 12px; margin-bottom: 10px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .schedule-item {
      border-radius: 10px; padding: 10px 12px; margin-bottom: 8px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .schedule-item-online { background: rgba(245,158,11,0.06); border: 1px solid rgba(245,158,11,0.2); }
    .schedule-item-live { background: rgba(239,68,68,0.06); border: 1px solid rgba(239,68,68,0.2); }
    .tip-preview-row { display: flex; gap: 10px; overflow-x: auto; scrollbar-width: none; }
    .tip-preview-row::-webkit-scrollbar { display: none; }
    .tip-preview-item { min-width: 120px; cursor: default; }
    .config-card {
      background: var(--bg); border: 1px solid var(--border);
      border-radius: 12px; padding: 14px; margin-bottom: 10px;
    }
    .extension-option {
      background: rgba(225,29,72,0.06); border: 1.5px solid rgba(225,29,72,0.25);
      border-radius: 12px; padding: 18px; margin-bottom: 10px; cursor: pointer;
    }
    .extension-option:active { transform: scale(0.98); background: rgba(225,29,72,0.1); }
    .timer-box {
      background: rgba(225,29,72,0.08); border: 1.5px solid rgba(225,29,72,0.3);
      border-radius: 12px; padding: 14px; text-align: center;
    }
    .max-warning {
      display: none; background: rgba(255,107,44,0.08);
      border: 1.5px solid rgba(255,107,44,0.25); border-radius: 10px;
      padding: 12px; margin-bottom: 14px; text-align: center;
    }
    .empty-state { color: var(--dim); font-size: 13px; text-align: center; padding: 16px; }

    /* ===== PROFILE ===== */
    .profile-header {
      background: linear-gradient(180deg, rgba(225,29,72,0.15) 0%, var(--bg) 100%);
      padding: 24px 16px 20px; position: relative;
    }
    .profile-avatar {
      width: 100px; height: 100px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 50px; font-weight: 900; border: 3px solid var(--accent); margin-bottom: 14px;
    }
    .profile-name { font-size: 24px; font-weight: 900; margin-bottom: 4px; }
    .profile-schedule-item {
      border-radius: 8px; padding: 8px 10px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .profile-schedule-online { background: rgba(245,158,11,0.06); border: 1px solid rgba(245,158,11,0.2); }
    .profile-schedule-live { background: rgba(239,68,68,0.06); border: 1px solid rgba(239,68,68,0.2); }

  </style>
</head>
<body>

  <div class="top-header">
    <div class="brand">
      <div class="brand-logo">STS</div>
      <div class="brand-name">Stream<span>To</span>Stage</div>
    </div>
    <div class="token-badge" id="tokenBadge">ü™ô 250</div>
  </div>

  <!-- ==================== BROWSE PAGE ==================== -->
  <div class="page active" id="browsePage">
    <div class="hero">
      <div class="hero-badge">üõ°Ô∏è 100% Verified Real Performers</div>
      <h1>The Only <span class="accent">Proof</span><br>She's <span class="accent">Real</span></h1>
      <p>Every performer works at a real venue you can visit. No AI. No filters. No fakes. See her live on stage ‚Äî that's the guarantee.</p>
    </div>

    <div class="search-container">
      <input type="text" class="search-bar" id="searchBar" inputmode="search"
        placeholder="Search states, clubs, performers..."
        autocomplete="off">
      <div class="search-results" id="searchResults"></div>
    </div>

    <!-- Trust Banner -->
    <div style="margin:0 16px 14px;padding:12px 14px;background:rgba(225,29,72,0.06);border:1px solid rgba(225,29,72,0.2);border-radius:10px;display:flex;align-items:center;gap:10px;">
      <div style="font-size:24px;">üõ°Ô∏è</div>
      <div>
        <div style="font-size:13px;font-weight:800;color:var(--accent);">Verified Performers Only</div>
        <div style="font-size:11px;color:var(--muted);">Every performer is verified at a real venue ‚Äî 667 clubs, 50 states</div>
      </div>
    </div>

    <!-- Trending Now -->
    <div class="trending" id="trendingSection">
      <div class="trending-header">
        <span style="color:var(--red);">üî¥</span>
        <h3>Live Right Now</h3>
      </div>
      <div class="trending-scroll" id="trendingScroll"></div>
    </div>

    <!-- How It Works -->
    <div class="how-it-works">
      <div class="how-grid">
        <div class="how-step">
          <div class="how-icon">üì±</div>
          <div class="how-label">Stream</div>
          <div class="how-desc">Watch her live from anywhere</div>
        </div>
        <div class="how-step" style="border-color:rgba(225,29,72,0.3);">
          <div class="how-icon">üõ°Ô∏è</div>
          <div class="how-label">Verified</div>
          <div class="how-desc">She works at a real club</div>
        </div>
        <div class="how-step">
          <div class="how-icon">üéüÔ∏è</div>
          <div class="how-label">Visit</div>
          <div class="how-desc">Go see her on stage IRL</div>
        </div>
      </div>
    </div>

    <div class="stats-bar">
      <div class="stat"><div class="stat-dot" style="background:var(--red);"></div><span id="liveCount">0 Live</span></div>
      <div class="stat"><div class="stat-dot" style="background:var(--dim);"></div><span id="offlineCount">0 Offline</span></div>
      <div class="stat clubs">667 Clubs</div>
    </div>
    <div class="section-label">All States</div>
    <div class="state-grid" id="stateGrid"></div>
  </div>

  <!-- ==================== ROOM ==================== -->
  <div class="page" id="roomPage">
    <div class="video-container">
      <button class="room-back-btn" onclick="leaveRoom()">‚Üê</button>
      <div class="room-avatar" id="roomAvatar"></div>
      <div class="room-name" id="roomName"></div>
      <div class="room-title" id="roomTitle"></div>
      <div class="room-stats">
        <div class="stat-badge stat-live"><div class="pulse-dot" style="display:inline-block;vertical-align:middle;"></div><span style="margin-left:5px;">LIVE</span></div>
        <div class="stat-badge stat-viewers" id="roomViewers"></div>
        <div class="stat-badge" id="roomVerified" style="background:rgba(225,29,72,0.1);color:var(--accent);border:1px solid rgba(225,29,72,0.3);font-size:11px;">üõ°Ô∏è Verified</div>
      </div>
      <div id="roomClub" style="font-size:11px;color:var(--gold);margin-top:6px;">üìç Club Name, ST</div>
      <div class="private-timer" id="privateTimer">
        <div class="timer-label">üîí PRIVATE SHOW</div>
        <div class="timer-display" id="timerDisplay">10:00</div>
        <div class="timer-sub">Time Remaining</div>
      </div>
      <button id="moreTimeBtn" class="btn-more-time" onclick="showMoreTimeOptions()">‚ûï ADD MORE TIME</button>
      <div class="room-controls">
        <button class="control-btn" onclick="openLovense()">üî• Lovense</button>
        <button class="control-btn control-btn-alt">üí¨ Chat</button>
      </div>
    </div>
    <div class="tip-section" id="tipButtons"></div>
    <div class="chat-section">
      <div class="chat-title">üí¨ RECENT ACTIVITY</div>
      <div class="chat-messages" id="chatMessages"></div>
    </div>
  </div>

  <!-- ==================== PROFILE ==================== -->
  <div class="page" id="profilePage">
    <div class="profile-header">
      <button class="btn-back" onclick="showPage('browse')">‚Üê</button>
      <div class="flex-col-center" style="margin-top:36px;">
        <div class="profile-avatar" id="profileAvatar"></div>
        <h2 class="profile-name" id="profileName"></h2>
        <div class="offline-badge"><span class="text-muted text-sm">‚ö´ Currently Offline</span></div>
        <div id="profileVenue" style="margin-top:8px;font-size:12px;color:var(--gold);">üõ°Ô∏è Verified at Club, State</div>
      </div>
    </div>
    <div class="page-pad">
      <div class="card card-surface mb-16">
        <h3 class="text-violet mb-16 text-xl">üìÖ Schedule</h3>
        <div class="mb-20">
          <div class="flex-gap mb-8"><div class="text-2xl">üü¢</div><div class="text-lg font-bold">Online Hours</div></div>
          <div class="text-muted text-sm mb-8">Available for chat & private bookings</div>
          <div class="flex-col-gap" id="profileOnlineSchedule"></div>
        </div>
        <div>
          <div class="flex-gap mb-8"><div class="text-2xl">üî¥</div><div class="text-lg font-bold text-red">Live Streaming</div></div>
          <div class="text-muted text-sm mb-8">Public shows & broadcasts</div>
          <div class="flex-col-gap" id="profileLiveSchedule"></div>
        </div>
      </div>
      <button class="btn-primary mb-12" onclick="bookPrivateShow()">üìÖ Book Private Show</button>
      <button class="btn-pink-lg" onclick="sendMessage()">üíå Send Message</button>
    </div>
  </div>

  <!-- ==================== TOKENS ==================== -->
  <div class="page" id="tokensPage">
    <div class="page-pad">
      <h2 class="text-violet text-3xl font-black mb-4">üí≥ Buy Tokens</h2>
      <p class="text-muted mb-20">Tip real, verified performers ‚Äî not bots</p>
    </div>
    <div class="package-grid" id="packageGrid"></div>
  </div>

  <!-- ==================== DASHBOARD ==================== -->
  <div class="page" id="dashboardPage">
    <div class="page-pad">
      <h2 class="text-violet text-3xl font-black mb-20">‚öôÔ∏è Performer Dashboard</h2>

      <div class="card card-surface mb-16">
        <div class="flex-between mb-16">
          <h3 class="text-violet text-xl">üí∞ Custom Tip Buttons</h3>
          <div class="config-badge config-badge-violet">4 buttons</div>
        </div>
        <p class="text-dim text-sm mb-16">Customize the 4 preset tip buttons in your room</p>
        <div id="tipButtonEditors"></div>
        <button class="btn-save mt-16" onclick="saveTipButtons()">üíæ Save Tip Buttons</button>
        <div class="section-divider">
          <h4 class="text-gold text-base mb-12">üëÅÔ∏è Preview</h4>
          <div class="tip-preview-row">
            <div id="tipPreview1" class="tip-btn tip-preview-item"><div class="tip-label">üéÅ Small</div><div class="tip-amount">ü™ô 10</div></div>
            <div id="tipPreview2" class="tip-btn tip-preview-item"><div class="tip-label">üíñ Medium</div><div class="tip-amount">ü™ô 50</div></div>
            <div id="tipPreview3" class="tip-btn tip-preview-item"><div class="tip-label">üíù Big</div><div class="tip-amount">ü™ô 100</div></div>
            <div id="tipPreview4" class="tip-btn tip-preview-item"><div class="tip-label">üêã Whale</div><div class="tip-amount">ü™ô 500</div></div>
          </div>
        </div>
      </div>

      <div class="card card-surface mb-16">
        <h3 class="text-gold text-xl mb-16">üîí Private Show Settings</h3>
        <div class="form-group-lg">
          <label class="form-label-md">üí∞ Tokens Per Minute</label>
          <input type="number" id="tokensPerMin" value="60" min="10" max="500" class="form-input form-input-gold">
          <div class="hint">Current: $6/min (60 tokens)</div>
        </div>
        <div class="form-group-lg">
          <label class="form-label-md">‚è±Ô∏è Minimum Duration (minutes)</label>
          <input type="number" id="minDuration" value="10" min="5" max="60" class="form-input form-input-gold">
          <div class="hint">Minimum booking: 10 minutes (600 tokens)</div>
        </div>
        <div class="section-divider">
          <h4 class="text-pink mb-12 text-lg">‚ûï Extension Options</h4>
          <p class="text-dim text-sm mb-16">Options shown during private shows</p>
          <div class="card-pink mb-12"><div class="grid-2col"><div><label class="form-label-sm">Minutes</label><input type="number" id="ext1Minutes" value="5" min="1" max="60" class="form-input form-input-pink"></div><div><label class="form-label-sm">Tokens</label><input type="number" id="ext1Tokens" value="250" min="10" max="5000" class="form-input form-input-pink"></div></div></div>
          <div class="card-pink mb-12"><div class="grid-2col"><div><label class="form-label-sm">Minutes</label><input type="number" id="ext2Minutes" value="10" min="1" max="60" class="form-input form-input-pink"></div><div><label class="form-label-sm">Tokens</label><input type="number" id="ext2Tokens" value="450" min="10" max="5000" class="form-input form-input-pink"></div></div></div>
          <div class="card-pink mb-12"><div class="grid-2col"><div><label class="form-label-sm">Minutes</label><input type="number" id="ext3Minutes" value="15" min="1" max="60" class="form-input form-input-pink"></div><div><label class="form-label-sm">Tokens</label><input type="number" id="ext3Tokens" value="650" min="10" max="5000" class="form-input form-input-pink"></div></div></div>
        </div>
        <button class="btn-save mt-16" onclick="savePrivateSettings()">üíæ Save Settings</button>
      </div>

      <div class="card card-gold mb-16" style="padding:14px;">
        <h4 class="text-gold text-base mb-8">üëÅÔ∏è Preview</h4>
        <div class="text-md text-muted leading-relaxed">
          <div><strong class="text-white">Price:</strong> $<span id="previewPrice">6</span>/min</div>
          <div><strong class="text-white">Min cost:</strong> <span id="previewMinCost">600</span> tokens ($<span id="previewMinCostUSD">60</span>)</div>
          <div class="mt-8"><strong class="text-white">Extensions:</strong></div>
          <div>+<span id="previewExt1Min">5</span>min = <span id="previewExt1Tokens">250</span> tokens</div>
          <div>+<span id="previewExt2Min">10</span>min = <span id="previewExt2Tokens">450</span> tokens</div>
          <div>+<span id="previewExt3Min">15</span>min = <span id="previewExt3Tokens">650</span> tokens</div>
        </div>
      </div>

      <div class="card card-surface mb-16" style="border-color:rgba(255,107,44,0.25);">
        <div class="flex-between mb-16">
          <h3 class="text-pink text-xl">üíó Lovense Levels</h3>
          <div class="config-badge config-badge-pink" id="lovenseLevelCount">4/5</div>
        </div>
        <div id="lovenseLevelsList"></div>
        <div class="max-warning" id="lovenseMaxWarning">
          <div class="text-pink font-bold text-md">‚ö†Ô∏è Maximum 5 levels</div>
          <div class="text-muted text-xs mt-4">Delete a level to add a new one</div>
        </div>
        <div id="lovenseAddForm">
          <div class="card card-pink-dashed" style="padding:14px;border-radius:12px;">
            <h4 class="text-pink text-base mb-12">‚ûï Add New Level</h4>
            <div class="form-group"><label class="form-label">Icon</label><select id="newLovenseIcon" class="form-select"><option value="üíó">üíó Heart</option><option value="üíñ">üíñ Sparkling</option><option value="üíù">üíù Gift</option><option value="üî•">üî• Fire</option><option value="‚ö°">‚ö° Lightning</option><option value="üí•">üí• Boom</option><option value="üåü">üåü Star</option><option value="‚ú®">‚ú® Sparkles</option><option value="üåä">üåä Wave</option><option value="üéÜ">üéÜ Fireworks</option></select></div>
            <div class="form-group"><label class="form-label">Label</label><input type="text" id="newLovenseLabel" placeholder="e.g., Low Vibe" maxlength="20" class="form-input form-input-pink"></div>
            <div class="grid-2col mb-12"><div><label class="form-label">Tokens</label><input type="number" id="newLovenseTokens" value="15" min="1" max="1000" class="form-input form-input-pink"></div><div><label class="form-label">Duration (sec)</label><input type="number" id="newLovenseDuration" value="10" min="1" max="300" class="form-input form-input-pink"></div></div>
            <button class="btn-pink w-full" onclick="addLovenseLevel()">‚ûï Add Level</button>
          </div>
        </div>
      </div>

      <div class="card card-surface" style="border-color:rgba(245,158,11,0.25);">
        <h3 class="text-gold text-xl mb-16">üìÖ My Schedule</h3>
        <p class="text-dim text-sm mb-20">Set your availability</p>
        <div class="section-border-bottom">
          <div class="flex-gap mb-8"><div class="text-2xl">üü¢</div><h4 class="text-lg font-bold">Online Hours</h4></div>
          <p class="text-muted text-sm mb-12">When you're available for chat & bookings</p>
          <div id="onlineScheduleList"></div>
          <button class="btn-add btn-add-online mt-12" onclick="addOnlineSchedule()">‚ûï Add Online Hours</button>
        </div>
        <div>
          <div class="flex-gap mb-8"><div class="text-2xl">üî¥</div><h4 class="text-red text-lg font-bold">Live Streaming</h4></div>
          <p class="text-muted text-sm mb-12">When you're broadcasting</p>
          <div id="liveScheduleList"></div>
          <button class="btn-add btn-add-live mt-12" onclick="addLiveSchedule()">‚ûï Add Live Hours</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== NAV ==================== -->
  <nav class="bottom-nav">
    <button class="nav-item active" onclick="showPage('browse')"><div class="nav-item-icon">üîç</div><div>Browse</div></button>
    <button class="nav-item" onclick="showPage('tokens')"><div class="nav-item-icon">üí≥</div><div>Wallet</div></button>
    <button class="nav-item" onclick="showPage('dashboard')"><div class="nav-item-icon">‚öôÔ∏è</div><div>Settings</div></button>
  </nav>

  <button class="floating-private-btn" id="floatingPrivateBtn" onclick="openPrivateSheet()">
    <div class="floating-btn-icon">üîí</div><div class="floating-btn-text">PRIVATE</div><div class="floating-btn-price">$6/min</div>
  </button>

  <!-- Browse Sheets -->
  <div class="overlay" id="browseOverlay"></div>
  <div class="bottom-sheet" id="clubSheet"><div class="sheet-handle"></div><div class="sheet-header"><h2 class="sheet-title" id="clubSheetTitle"></h2><p class="sheet-subtitle" id="clubSheetSubtitle"></p></div><div class="sheet-content" id="clubSheetContent"></div></div>
  <div class="bottom-sheet" id="streamerSheet"><div class="sheet-handle"></div><div class="sheet-header" style="display:flex;align-items:center;"><button class="back-btn-sheet" id="backBtn">‚Üê</button><div><h2 class="sheet-title" id="streamerSheetTitle"></h2><p class="sheet-subtitle" id="streamerSheetSubtitle"></p></div></div><div class="sheet-content" id="streamerSheetContent"></div></div>

  <!-- Room Sheets -->
  <div class="sheet-overlay" id="lovenseOverlay" onclick="closeLovense()"></div>
  <div class="bottom-sheet" id="lovenseSheet"><div class="sheet-handle"></div><div class="sheet-header"><div class="sheet-title">üî• Lovense Control</div><div class="sheet-subtitle">Lush 4 ‚Ä¢ üîã 87%</div><button class="close-btn" onclick="closeLovense()">‚úï</button></div><div class="sheet-content" id="lovenseContent"></div></div>

  <div class="sheet-overlay" id="privateOverlay" onclick="closePrivateSheet()"></div>
  <div class="bottom-sheet" id="privateSheet"><div class="sheet-handle"></div><div class="sheet-header"><div class="sheet-title text-violet">üîí Private Show</div><div class="sheet-subtitle">Exclusive 1-on-1 experience</div><button class="close-btn" onclick="closePrivateSheet()">‚úï</button></div>
    <div class="sheet-content">
      <div class="card-premium mb-20">
        <div class="text-center mb-20"><div style="font-size:48px;" class="mb-8">üëë</div><div class="text-2xl font-black text-violet mb-4">Exclusive 1-on-1</div><div class="text-base text-muted">Just you and the performer</div></div>
        <div class="grid-2col mb-20"><div class="card-stat"><div class="text-4xl font-black text-violet">$6</div><div class="text-sm text-muted">per minute</div></div><div class="card-stat"><div class="text-4xl font-black text-violet">10 min</div><div class="text-sm text-muted">minimum</div></div></div>
        <div style="background:rgba(0,0,0,0.3);padding:16px;border-radius:12px;border:1px solid var(--border);" class="mb-20"><div class="text-base font-bold text-gold mb-8">‚ú® What's Included:</div><div class="text-md text-muted leading-relaxed">Full control of the show ‚Ä¢ Two-way audio & video ‚Ä¢ Custom requests ‚Ä¢ Lovense control ‚Ä¢ Recording (+$20)</div></div>
        <button class="btn-primary" onclick="startPrivateShow()">üîí START PRIVATE SHOW ($60)</button>
      </div>
      <div class="card-spy">
        <div class="flex-gap-lg mb-12"><div style="font-size:36px;">üëÅÔ∏è</div><div><div class="text-xl font-black text-cyan mb-4">Spy Mode</div><div class="text-sm text-muted">Watch someone else's show</div></div></div>
        <div class="flex-between mt-12"><div><div class="text-2xl font-black text-cyan">$3/min</div><div class="text-xs text-muted">Watch only</div></div><button class="btn-spy" onclick="joinSpyMode()">JOIN SPY</button></div>
      </div>
    </div>
  </div>

  <div class="sheet-overlay" id="moreTimeOverlay" onclick="closeMoreTimeSheet()"></div>
  <div class="bottom-sheet" id="moreTimeSheet"><div class="sheet-handle"></div><div class="sheet-header"><div class="sheet-title text-gold">‚ûï Add More Time</div><div class="sheet-subtitle">Extend your private show</div><button class="close-btn" onclick="closeMoreTimeSheet()">‚úï</button></div>
    <div class="sheet-content"><div class="timer-box mb-16"><div class="text-base text-muted mb-8">‚è±Ô∏è Time Remaining</div><div class="text-5xl font-black" style="font-family:monospace;" id="moreTimeCurrentTimer">10:00</div></div><div id="extensionOptions"></div></div>
  </div>

  <script>
class Database {
  _get(key) { try { return this._get(key); } catch(e) { return null; } }
  _set(key, val) { try { this._set(key, val); } catch(e) {} }
  _del(key) { try { this._del(key); } catch(e) {} }
  constructor() {
    this.initializeDefaults();
  }

  initializeDefaults() {
    // Only set defaults if nothing exists
    if (!this._get('livestream_initialized')) {
      // User data
      this.setBalance(250);
      
      // Default tip buttons
      this.saveTipButtons([
        { icon: 'üéÅ', label: 'Small', amount: 10 },
        { icon: 'üíñ', label: 'Medium', amount: 50 },
        { icon: 'üíù', label: 'Big', amount: 100 },
        { icon: 'üêã', label: 'Whale', amount: 500 }
      ]);
      
      // Default Lovense levels
      this.saveLovenseLevels([
        { id: 1, icon: 'üíó', label: 'Low Vibe', tokens: 15, duration: 10 },
        { id: 2, icon: 'üíñ', label: 'Medium Vibe', tokens: 30, duration: 15 },
        { id: 3, icon: 'üíù', label: 'High Vibe', tokens: 60, duration: 20 },
        { id: 4, icon: 'üî•', label: 'Ultra Vibe', tokens: 100, duration: 30 }
      ]);
      
      // Default schedules
      this.saveOnlineSchedule([
        { id: 1, day: 'Monday', startTime: '18:00', endTime: '23:00' },
        { id: 2, day: 'Wednesday', startTime: '19:00', endTime: '00:00' },
        { id: 3, day: 'Friday', startTime: '20:00', endTime: '02:00' }
      ]);
      
      this.saveLiveSchedule([
        { id: 1, day: 'Monday', startTime: '20:00', endTime: '22:00' },
        { id: 2, day: 'Friday', startTime: '21:00', endTime: '23:00' }
      ]);
      
      // Default private show settings
      this.savePrivateShowSettings({
        tokensPerMin: 60,
        minDuration: 10,
        extensions: [
          { minutes: 5, tokens: 250 },
          { minutes: 10, tokens: 450 },
          { minutes: 15, tokens: 650 }
        ]
      });
      
      this._set('livestream_initialized', 'true');
    }
  }

  // ============================================
  // USER / WALLET METHODS
  // ============================================

  getBalance() {
    const balance = this._get('livestream_balance');
    return balance ? parseInt(balance) : 250;
  }

  setBalance(amount) {
    this._set('livestream_balance', amount.toString());
  }

  async addTokens(amount) {
    const current = this.getBalance();
    this.setBalance(current + amount);
    
    // Save transaction
    this.addTransaction({
      type: 'purchase',
      amount: amount,
      timestamp: Date.now()
    });
    
    return { success: true, newBalance: current + amount };
  }

  async deductTokens(amount, reason = 'unknown') {
    const current = this.getBalance();
    
    if (current < amount) {
      return { success: false, error: 'Insufficient balance' };
    }
    
    this.setBalance(current - amount);
    
    // Save transaction
    this.addTransaction({
      type: reason,
      amount: -amount,
      timestamp: Date.now()
    });
    
    return { success: true, newBalance: current - amount };
  }

  // ============================================
  // TIP BUTTONS
  // ============================================

  getTipButtons() {
    const stored = this._get('livestream_tip_buttons');
    return stored ? JSON.parse(stored) : [];
  }

  saveTipButtons(buttons) {
    this._set('livestream_tip_buttons', JSON.stringify(buttons));
  }

  // ============================================
  // LOVENSE LEVELS
  // ============================================

  getLovenseLevels() {
    const stored = this._get('livestream_lovense_levels');
    return stored ? JSON.parse(stored) : [];
  }

  saveLovenseLevels(levels) {
    this._set('livestream_lovense_levels', JSON.stringify(levels));
  }

  // ============================================
  // SCHEDULES
  // ============================================

  getOnlineSchedule() {
    const stored = this._get('livestream_online_schedule');
    return stored ? JSON.parse(stored) : [];
  }

  saveOnlineSchedule(schedule) {
    this._set('livestream_online_schedule', JSON.stringify(schedule));
  }

  getLiveSchedule() {
    const stored = this._get('livestream_live_schedule');
    return stored ? JSON.parse(stored) : [];
  }

  saveLiveSchedule(schedule) {
    this._set('livestream_live_schedule', JSON.stringify(schedule));
  }

  // ============================================
  // PRIVATE SHOW SETTINGS
  // ============================================

  getPrivateShowSettings() {
    const stored = this._get('livestream_private_settings');
    return stored ? JSON.parse(stored) : {
      tokensPerMin: 60,
      minDuration: 10,
      extensions: [{minutes:5,tokens:250},{minutes:10,tokens:450},{minutes:15,tokens:650}]
    };
  }

  savePrivateShowSettings(settings) {
    this._set('livestream_private_settings', JSON.stringify(settings));
  }

  // ============================================
  // TRANSACTIONS / HISTORY
  // ============================================

  getTransactions(limit = 50) {
    const stored = this._get('livestream_transactions');
    const transactions = stored ? JSON.parse(stored) : [];
    return transactions.slice(0, limit);
  }

  addTransaction(transaction) {
    const stored = this._get('livestream_transactions');
    const transactions = stored ? JSON.parse(stored) : [];
    
    transactions.unshift({
      id: Date.now(),
      ...transaction
    });
    
    // Keep only last 100 transactions
    const trimmed = transactions.slice(0, 100);
    this._set('livestream_transactions', JSON.stringify(trimmed));
  }

  // ============================================
  // STREAMERS
  // ============================================

  async getStreamerProfile(streamerId) {
    return {
      id: streamerId,
      name: 'Crystal Rose',
      avatar: 'C',
      color: '#ff5733',
      isLive: false,
      viewers: 0,
      onlineSchedule: this.getOnlineSchedule(),
      liveSchedule: this.getLiveSchedule()
    };
  }

  async getStreamers(filters = {}) {
    return [];
  }

  // ============================================
  // MESSAGES (Placeholder)
  // ============================================

  async getMessages() {
    return [];
  }

  async sendMessage(toUserId, content) {
    return { success: true, messageId: Date.now() };
  }

  // ============================================
  // AUTHENTICATION (For Production)
  // ============================================

  getAuthToken() {
    return null;
  }

  async login(username, password) {
    return { success: true, token: null };
  }

  async logout() {
    const keys = Object.keys(localStorage).filter(k => k.startsWith('livestream_'));
    keys.forEach(key => this._del(key));
  }

  // ============================================
  // UTILITY METHODS
  // ============================================

  clearAllData() {
    const keys = Object.keys(localStorage).filter(k => k.startsWith('livestream_'));
    keys.forEach(key => this._del(key));
    this.initializeDefaults();
  }

  exportData() {
    return {
      balance: this.getBalance(),
      tipButtons: this.getTipButtons(),
      lovenseLevels: this.getLovenseLevels(),
      onlineSchedule: this.getOnlineSchedule(),
      liveSchedule: this.getLiveSchedule(),
      privateSettings: this.getPrivateShowSettings(),
      transactions: this.getTransactions()
    };
  }

  importData(data) {
    if (data.balance) this.setBalance(data.balance);
    if (data.tipButtons) this.saveTipButtons(data.tipButtons);
    if (data.lovenseLevels) this.saveLovenseLevels(data.lovenseLevels);
    if (data.onlineSchedule) this.saveOnlineSchedule(data.onlineSchedule);
    if (data.liveSchedule) this.saveLiveSchedule(data.liveSchedule);
    if (data.privateSettings) this.savePrivateShowSettings(data.privateSettings);
  }
}

// ============================================
// EXPORT SINGLETON INSTANCE
// ============================================

// Create and export a single instance
const db = new Database();
if (typeof window !== 'undefined') { window.db = db; }

    const CLUBS = {"AK":["Club SinRock","The Crazy Horse"],"AL":["Diamonds Gentlemen's Club","Paradise Gentlemen's Club"],"AR":["Centerfold","Cheyenne Gentlemen's Club"],"AZ":["Bandaids Showclub","Cheetahs Gentlemen's Club"],"CA":["Centerfolds","Cheetahs","Spearmint Rhino","Gold Club SF"],"CO":["Diamond Cabaret","PT's Showclub","Shotgun Willie's"],"CT":["Hollywood Cabaret","Pure Platinum"],"DE":["Cheeks","Fairways Inn"],"FL":["E11EVEN Miami","King of Diamonds (KOD)","Mons Venus","Tootsie's Cabaret"],"GA":["Magic City","Blue Flame Lounge","Clermont Lounge"],"HI":["Club 550","Club Femme Nu"],"IA":["Spearmint Rhino","Dancers Ranch"],"ID":["Stateline Showgirls","Satin Dolls"],"IL":["Larry Flynt's Hustler Club","Rick's Cabaret"],"IN":["Brad's Brass Flamingo","PT's Showclub"],"KS":["Baby Dolls","Executive Lounge"],"KY":["Spearmint Rhino","PT's Showclub"],"LA":["Larry Flynt's Hustler Club","Rick's Cabaret"],"MA":["Centerfolds","Glass Slipper","Golden Banana"],"MD":["Larry Flynt's Hustler Club","Rick's Cabaret"],"ME":["Platinum Plus"],"MI":["Flight Club","Penthouse Club","Henry the 8th"],"MN":["Rick's Cabaret","Spearmint Rhino"],"MO":["Club V","Crazyhorse"],"MS":["Babes Show Club","The Pony"],"MT":["Shotgun Willie's","Teasers GC"],"NC":["Rick's Cabaret","The Gold Club"],"ND":["The Northern"],"NE":["Club Omaha","The Foxy GC"],"NH":["Leather and Lace","Sugaz GC"],"NJ":["Satin Dolls","Delilah's Den"],"NM":["Spearmint Rhino","Fantasies"],"NV":["Sapphire Las Vegas","Spearmint Rhino","Little Darlings","Treasures"],"NY":["Hustler Club NYC","Rick's Cabaret NYC"],"OH":["Larry Flynt's Hustler Club","Columbus Gold"],"OK":["Night Trips Tulsa","Sensations"],"OR":["Acropolis Steakhouse","Mary's Club"],"PA":["Rick's Cabaret","Cheerleaders Philly"],"RI":["The Foxy Lady","Rhode Island Dolls"],"SC":["Platinum West","Cheetah Premier"],"SD":["Shotgun Willie's","Kongo Klub"],"TN":["Hustler Club","Deja Vu Showgirls"],"TX":["Rick's Cabaret DFW","The Men's Club","Baby Dolls"],"UT":["Southern X-Posure","The American Bush"],"VA":["Paper Moon","Pure Pleasure"],"VT":["The Den"],"WA":["Dream Girls at SoDo","Deja Vu Showgirls"],"WI":["Silk Exotic Madison","Peppermint Hippo"],"WV":["Southern X-Posure","The Filly"],"WY":["Green Door Lounge","Paradise Lounge"]};
    const STATE_NAMES = {AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"};
    const FIRST_NAMES = ["Amber","Crystal","Diamond","Jade","Ruby","Sapphire","Luna","Star","Angel","Heaven","Candy","Sugar","Honey","Cherry","Peach"];
    const LAST_NAMES = ["Rose","Sky","Star","Night","Dawn","Love","Dreams","Fire","Ice","Storm","Rain","Snow","Moon","Sun","Divine"];
    const TITLES = ["Feeling playful tonight üíã","Come say hi! üåü","Private shows open üîí","New here, be nice üíñ","Birthday week! üéâ","Just vibing ‚ú®","Ask me anything üí¨","Late night fun üåô"];
    const PACKAGES = [{name:"Starter",tokens:100,price:4.99,popular:false},{name:"Popular",tokens:500,price:19.99,popular:true},{name:"Pro",tokens:1200,price:39.99,popular:false},{name:"Whale",tokens:5000,price:149.99,popular:false}];

    // STATE
    let counts = {};
    let streamerCache = {}; // FIX #5: lazy generation with cache
    let currentStreamer = null, currentProfile = null;
    let isInPrivateShow = false, privateShowTimeRemaining = 0, privateShowTimer = null;
    let searchDebounceTimer = null; // FIX #6: debounce
    let chatHistory = [
      {type:"system",text:"Welcome to StreamToStage ‚Äî 100% verified real performers üõ°Ô∏è"},
      {type:"tip",user:"viewer_42",text:"hey! üëã"},
      {type:"tip",user:"BigSpender",amount:100,label:"üî•"}
    ];

    // FIX #4: Seeded random for consistent streamer state
    function seededRandom(seed) { seed = (seed * 9301 + 49297) % 233280; return seed / 233280; }

    function generateStreamers(clubName, stateAbbr) {
      const key = stateAbbr + ':' + clubName;
      if (streamerCache[key]) return streamerCache[key]; // FIX #5: cache
      const seed = clubName.split('').reduce((a,c) => a+c.charCodeAt(0), 0);
      const count = 3 + (seed % 6);
      const liveCount = Math.floor(seededRandom(seed + counts[stateAbbr]?.live) * Math.min(count, 4)); // FIX #4: seeded
      const streamers = [];
      for (let i = 0; i < count; i++) {
        const fn = FIRST_NAMES[(seed+i*7)%FIRST_NAMES.length];
        const ln = LAST_NAMES[(seed+i*13)%LAST_NAMES.length];
        const isLive = i < liveCount;
        const hue = (seed+i*30)%360;
        streamers.push({
          id: stateAbbr+'-'+clubName.replace(/[^a-zA-Z0-9]/g,'')+'-'+i,
          name: fn+' '+ln, club: clubName, state: stateAbbr,
          isLive, viewers: isLive ? 50 + Math.floor(seededRandom(seed+i*99)*450) : 0,
          avatar: fn[0], color: 'hsl('+hue+',60%,45%)',
          title: TITLES[(seed+i)%TITLES.length]
        });
      }
      streamerCache[key] = streamers;
      return streamers;
    }

    // BROWSE
    function initBrowse() {
      Object.keys(CLUBS).forEach(s => {
        const n = CLUBS[s].length;
        counts[s] = { live: Math.floor(seededRandom(s.charCodeAt(0)*31+s.charCodeAt(1))*Math.min(n,8)), offline: Math.floor(seededRandom(s.charCodeAt(0)*17)*Math.min(n*2,15)) };
      });
      renderStateGrid();
      updateBrowseStats();
      renderTrending();
    }

    function renderTrending() {
      // FIX #5: generate trending lazily from a few states
      const hotStates = ['NV','FL','CA','NY','TX','GA'];
      let trending = [];
      hotStates.forEach(st => {
        if (!CLUBS[st]) return;
        CLUBS[st].forEach(club => {
          generateStreamers(club, st).forEach(s => { if (s.isLive) trending.push(s); });
        });
      });
      trending.sort((a,b) => b.viewers - a.viewers);
      trending = trending.slice(0, 10);
      const el = document.getElementById('trendingScroll');
      if (!trending.length) { document.getElementById('trendingSection').style.display='none'; return; }
      el.innerHTML = trending.map(s => `
        <div class="trending-card" onclick="enterRoomDirect('${esc(s.id)}','${esc(s.name)}','${s.avatar}','${s.color}',${s.viewers},'${esc(s.title)}','${esc(s.club)}','${s.state}')">
          <div class="trending-thumb" style="background:${s.color};">${s.avatar}<div class="trending-live">LIVE</div></div>
          <div class="trending-info"><div class="trending-name">${esc(s.name)}</div><div class="trending-viewers">üëÅÔ∏è ${s.viewers}</div><div class="trending-club">üõ°Ô∏è ${esc(s.club)}</div></div>
        </div>`).join('');
    }

    // FIX #14: safe HTML escaping
    function esc(str) { return String(str).replace(/&/g,'&amp;').replace(/'/g,'&#39;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function renderStateGrid() {
      const grid = document.getElementById('stateGrid');
      const sorted = Object.keys(STATE_NAMES).sort((a,b) => {
        const al=counts[a]?.live||0, bl=counts[b]?.live||0;
        if(al>0&&bl===0) return -1; if(bl>0&&al===0) return 1;
        return STATE_NAMES[a].localeCompare(STATE_NAMES[b]);
      });
      grid.innerHTML = sorted.map(ab => {
        const c=counts[ab]||{live:0,offline:0}; const clubs=CLUBS[ab]?.length||0;
        return '<div class="state-card '+(c.live>0?'has-live':'')+'" onclick="openState(\''+ab+'\')"><div class="state-name">'+STATE_NAMES[ab]+'</div><div class="state-counts">'+(c.live>0?'<div class="count-item"><span class="count-live">üî¥ '+c.live+'</span></div>':'')+(c.offline>0?'<div class="count-item"><span class="count-offline">‚ö´ '+c.offline+'</span></div>':'')+'</div><div class="state-clubs">'+clubs+' clubs</div></div>';
      }).join('');
    }

    function updateBrowseStats() {
      document.getElementById('liveCount').textContent = Object.values(counts).reduce((s,c)=>s+c.live,0)+' Live';
      document.getElementById('offlineCount').textContent = Object.values(counts).reduce((s,c)=>s+c.offline,0)+' Offline';
    }

    // FIX #6: debounced search
    const searchBar = document.getElementById('searchBar');
    const searchResults = document.getElementById('searchResults');
    searchBar.addEventListener('input', () => {
      clearTimeout(searchDebounceTimer);
      searchDebounceTimer = setTimeout(performSearch, 150);
    });
    function performSearch() {
      const q = searchBar.value.trim().toLowerCase();
      if (!q) { searchResults.classList.remove('visible'); return; }
      const states = Object.entries(STATE_NAMES).filter(([a,n])=>n.toLowerCase().includes(q)||a.toLowerCase().includes(q)).slice(0,5);
      const clubs = [];
      Object.entries(CLUBS).forEach(([st,cl])=>{ cl.forEach(c=>{ if(c.toLowerCase().includes(q)) clubs.push({name:c,state:st}); }); });
      // FIX #5: search only generates streamers for matching clubs, not all
      const streamers = [];
      clubs.slice(0,3).forEach(cl => {
        generateStreamers(cl.name, cl.state).forEach(s => { if(s.name.toLowerCase().includes(q)) streamers.push(s); });
      });
      // Also search cached streamers
      Object.values(streamerCache).flat().forEach(s => { if(s.name.toLowerCase().includes(q) && !streamers.find(x=>x.id===s.id)) streamers.push(s); });

      let html = '';
      if(states.length) {
        html += '<div class="search-category">üó∫Ô∏è States</div>';
        states.forEach(([ab,name])=>{
          const c=counts[ab]||{live:0,offline:0};
          html += '<div class="search-item" onclick="selectState(\''+ab+'\')"><div class="search-icon">üó∫Ô∏è</div><div class="search-item-info"><div class="search-item-name">'+esc(name)+'</div><div class="search-item-meta">'+c.live+' live ‚Ä¢ '+c.offline+' offline</div></div>'+(c.live>0?'<div class="search-live-badge">LIVE</div>':'')+'</div>';
        });
      }
      if(clubs.length) {
        html += '<div class="search-category">üè¢ Clubs</div>';
        clubs.slice(0,5).forEach(cl=>{
          html += '<div class="search-item" onclick="selectClub(\''+esc(cl.name)+'\',\''+cl.state+'\')"><div class="search-icon">üè¢</div><div class="search-item-info"><div class="search-item-name">'+esc(cl.name)+'</div><div class="search-item-meta">'+STATE_NAMES[cl.state]+'</div></div></div>';
        });
      }
      if(streamers.length) {
        html += '<div class="search-category">üë§ Performers</div>';
        streamers.slice(0,5).forEach(s=>{
          html += '<div class="search-item" onclick="openStreamerFromSearch(\''+esc(s.id)+'\')"><div class="search-icon">üë§</div><div class="search-item-info"><div class="search-item-name">'+esc(s.name)+'</div><div class="search-item-meta">'+esc(s.club)+', '+STATE_NAMES[s.state]+'</div></div>'+(s.isLive?'<div class="search-live-badge">LIVE</div>':'')+'</div>';
        });
      }
      if(!html) html='<div class="no-results">No results found</div>';
      searchResults.innerHTML = html;
      searchResults.classList.add('visible');
    }
    document.addEventListener('click', e => { if(!e.target.closest('.search-container')) searchResults.classList.remove('visible'); });

    function selectState(ab) { searchBar.value=''; searchResults.classList.remove('visible'); openState(ab); }
    function selectClub(name, st) { searchBar.value=''; searchResults.classList.remove('visible'); openClub(name, st); }
    function openStreamerFromSearch(id) {
      searchBar.value=''; searchResults.classList.remove('visible'); closeBrowseSheets();
      const s = Object.values(streamerCache).flat().find(x=>x.id===id);
      if(s && s.isLive) openRoom(s); else if(s) openProfile(s.name, s.avatar, s.color, s.club, s.state);
    }
    function enterRoomDirect(id,name,avatar,color,viewers,title,club,state) { openRoom({id,name,avatar,color,viewers,title,club,state}); }

    function openState(ab) {
      const clubs = CLUBS[ab]||[]; const c = counts[ab]||{live:0,offline:0};
      document.getElementById('clubSheetTitle').textContent = STATE_NAMES[ab];
      document.getElementById('clubSheetSubtitle').textContent = clubs.length+' clubs ‚Ä¢ '+c.live+' live';
      const ws = clubs.map((club,i)=>({name:club, isLive:i<c.live, viewers:i<c.live?50+Math.floor(seededRandom(club.length*31+i)*450):0}));
      document.getElementById('clubSheetContent').innerHTML = ws.map(cl =>
        '<div class="sheet-item '+(cl.isLive?'live':'')+'" onclick="openClub(\''+esc(cl.name)+'\',\''+ab+'\')"><div><div class="item-name '+(cl.isLive?'live':'')+'">'+esc(cl.name)+'</div>'+(!cl.isLive?'<div class="item-status">Offline</div>':'')+'</div>'+(cl.isLive?'<div class="live-badge"><div class="pulse-dot"></div><span>'+cl.viewers+' watching</span></div>':'')+'</div>'
      ).join('');
      document.getElementById('browseOverlay').classList.add('visible');
      document.getElementById('clubSheet').classList.add('open');
    }

    function openClub(clubName, st) {
      const streamers = generateStreamers(clubName, st);
      const live=streamers.filter(s=>s.isLive), offline=streamers.filter(s=>!s.isLive);
      document.getElementById('streamerSheetTitle').textContent = clubName;
      document.getElementById('streamerSheetSubtitle').textContent = STATE_NAMES[st]+' ‚Ä¢ '+live.length+' live ‚Ä¢ '+offline.length+' offline';
      let html='';
      if(live.length) {
        html += '<div class="section-header live">üî¥ LIVE NOW ('+live.length+')</div>';
        html += live.map(s=>'<div class="sheet-item live" onclick="enterRoom(\''+esc(s.id)+'\',\''+esc(s.name)+'\',\''+s.avatar+'\',\''+s.color+'\','+s.viewers+',\''+esc(s.title)+'\')"><div class="streamer-item"><div class="streamer-avatar" style="background:'+s.color+'">'+s.avatar+'</div><div class="streamer-info"><div class="streamer-name live">'+esc(s.name)+'</div><div class="streamer-viewers">üëÅÔ∏è '+s.viewers+' watching</div></div></div><div style="color:var(--red);font-size:16px;">‚ñ∂</div></div>').join('');
      }
      if(offline.length) {
        html += '<div class="section-header offline">‚ö´ OFFLINE ('+offline.length+')</div>';
        html += offline.map(s=>'<div class="sheet-item" onclick="enterProfile(\''+esc(s.name)+'\',\''+s.avatar+'\',\''+s.color+'\',\''+esc(s.club)+'\',\''+s.state+'\')" style="opacity:0.6;"><div class="streamer-item"><div class="streamer-avatar offline" style="background:'+s.color+'">'+s.avatar+'</div><div class="streamer-info"><div class="streamer-name offline">'+esc(s.name)+'</div><div class="streamer-viewers" style="color:var(--dim);">View profile</div></div></div><div style="color:var(--dim);">üë§</div></div>').join('');
      }
      document.getElementById('streamerSheetContent').innerHTML = html;
      document.getElementById('clubSheet').classList.remove('open');
      document.getElementById('streamerSheet').classList.add('open');
    }

    function enterRoom(id,name,av,color,v,title) { closeBrowseSheets(); openRoom({id,name,avatar:av,color,viewers:v,title}); }
    function enterProfile(name,av,color,club,state) { closeBrowseSheets(); openProfile(name,av,color,club,state); }
    document.getElementById('backBtn').onclick = () => { document.getElementById('streamerSheet').classList.remove('open'); document.getElementById('clubSheet').classList.add('open'); };
    document.getElementById('browseOverlay').onclick = () => closeBrowseSheets();
    function closeBrowseSheets() { document.getElementById('browseOverlay').classList.remove('visible'); document.getElementById('clubSheet').classList.remove('open'); document.getElementById('streamerSheet').classList.remove('open'); }

    // ROOM
    function openRoom(streamer) {
      currentStreamer = streamer;
      document.getElementById('roomAvatar').innerHTML = streamer.avatar;
      document.getElementById('roomAvatar').style.background = streamer.color;
      document.getElementById('roomName').textContent = streamer.name;
      document.getElementById('roomTitle').textContent = streamer.title || 'Live now!';
      document.getElementById('roomViewers').textContent = 'üëÅÔ∏è '+(streamer.viewers||0).toLocaleString();
      document.getElementById('roomClub').textContent = 'üìç Verified at '+(streamer.club||'Club')+', '+(STATE_NAMES[streamer.state]||streamer.state||'');
      const tips = db.getTipButtons();
      document.getElementById('tipButtons').innerHTML = tips.map(t=>'<button class="tip-btn" onclick="sendTip('+t.amount+',\''+esc(t.icon+' '+t.label)+'\')"><div class="tip-label">'+esc(t.icon+' '+t.label)+'</div><div class="tip-amount">ü™ô '+t.amount+'</div></button>').join('');
      const levels = db.getLovenseLevels();
      document.getElementById('lovenseContent').innerHTML = levels.map(l=>'<div class="lovense-item" onclick="activateLovense(\''+esc(l.label)+'\','+l.tokens+','+l.duration+')"><span class="lovense-label">'+l.icon+' '+esc(l.label)+'</span><div style="display:flex;flex-direction:column;align-items:flex-end;gap:2px;"><span class="lovense-cost">ü™ô '+l.tokens+'</span><span class="lovense-duration">'+l.duration+'s</span></div></div>').join('');
      renderChat();
      showPage('room');
    }

    function leaveRoom() {
      if(isInPrivateShow) { if(!confirm('Leave private show? Time will be lost.')) return; endPrivateShow(); }
      showPage('browse');
    }
    function sendTip(amount, label) {
      if(db.getBalance()<amount){alert('Not enough tokens!');return;}
      db.deductTokens(amount,'tip'); updateBalance();
      chatHistory.unshift({type:'tip',user:'you',text:label,amount}); renderChat();
    }
    function activateLovense(label,tokens,dur) {
      if(db.getBalance()<tokens){alert('Not enough tokens!');return;}
      db.deductTokens(tokens,'lovense'); updateBalance();
      chatHistory.unshift({type:'lovense',user:'you',text:label+' ('+dur+'s)',amount:tokens}); renderChat(); closeLovense();
    }
    function renderChat() {
      document.getElementById('chatMessages').innerHTML = chatHistory.slice(0,10).map(m => {
        if(m.type==='tip'&&m.amount) return '<div class="chat-msg"><span class="chat-user">'+esc(m.user)+'</span><span>'+esc(m.text)+'</span><span class="chat-tip-amount">ü™ô '+m.amount+'</span></div>';
        if(m.type==='lovense') return '<div class="chat-msg chat-msg-lovense"><span class="chat-user chat-user-pink">'+esc(m.user)+'</span><span>activated '+esc(m.text)+'</span><span class="chat-tip-amount chat-tip-pink">ü™ô '+m.amount+'</span></div>';
        return '<div class="chat-msg">'+esc(m.text)+'</div>';
      }).join('');
    }
    function buyPackage(t) { db.addTokens(t); updateBalance(); alert('Added '+t+' tokens!'); }
    function updateBalance() { document.getElementById('tokenBadge').textContent='ü™ô '+db.getBalance().toLocaleString(); }
    function renderPackages() {
      const icons=['üí∞','‚≠ê','üíé','üêã'];
      document.getElementById('packageGrid').innerHTML = PACKAGES.map((p,i)=>'<div class="package-card '+(p.popular?'popular':'')+'">'+( p.popular?'<div class="popular-badge">‚≠ê MOST POPULAR</div>':'')+'<div class="package-icon">'+icons[i]+'</div><div class="package-name">'+p.name+'</div><div class="package-tokens">'+p.tokens.toLocaleString()+'</div><div class="package-label">tokens</div><button class="buy-btn '+(p.popular?'popular':'')+'" onclick="buyPackage('+p.tokens+')">BUY $'+p.price+'</button></div>').join('');
    }

    // NAV - FIX #9: scroll to top on page change
    function showPage(page) {
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
      const fl=document.getElementById('floatingPrivateBtn'); fl.style.display='none';
      const map = {browse:['browsePage',0],room:['roomPage',-1],profile:['profilePage',-1],tokens:['tokensPage',1],dashboard:['dashboardPage',2]};
      const [pageId, navIdx] = map[page]||map.browse;
      document.getElementById(pageId).classList.add('active');
      if(navIdx>=0) document.querySelectorAll('.nav-item')[navIdx].classList.add('active');
      if(page==='room') fl.style.display='block';
      window.scrollTo(0,0); // FIX #9
    }

    // SHEETS
    function openLovense(){document.getElementById('lovenseOverlay').classList.add('visible');document.getElementById('lovenseSheet').classList.add('open');}
    function closeLovense(){document.getElementById('lovenseOverlay').classList.remove('visible');document.getElementById('lovenseSheet').classList.remove('open');}
    function openPrivateSheet(){document.getElementById('privateOverlay').classList.add('visible');document.getElementById('privateSheet').classList.add('open');}
    function closePrivateSheet(){document.getElementById('privateOverlay').classList.remove('visible');document.getElementById('privateSheet').classList.remove('open');}
    function closeMoreTimeSheet(){document.getElementById('moreTimeOverlay').classList.remove('visible');document.getElementById('moreTimeSheet').classList.remove('open');}

    // PRIVATE SHOW
    function startPrivateShow() {
      const s=db.getPrivateShowSettings(); const bal=db.getBalance(); const cost=s.tokensPerMin*s.minDuration;
      if(bal<cost){alert('Not enough tokens!\n\n'+cost+' needed ('+s.minDuration+' min).\nBalance: '+bal+'\n\nVisit Wallet to buy more.');closePrivateSheet();showPage('tokens');return;}
      db.deductTokens(cost,'private-show'); updateBalance(); closePrivateSheet();
      isInPrivateShow=true; privateShowTimeRemaining=s.minDuration*60;
      document.getElementById('privateTimer').style.display='block'; document.getElementById('moreTimeBtn').style.display='block';
      updateTimerDisplay();
      privateShowTimer=setInterval(()=>{privateShowTimeRemaining--;updateTimerDisplay();if(privateShowTimeRemaining<=0)endPrivateShow();},1000);
      chatHistory.unshift({type:'system',text:'üîí Private show started! '+s.minDuration+' min'}); renderChat();
      alert('üîí Private Show Started!\n\n‚è±Ô∏è '+s.minDuration+' minutes\nüí∞ '+cost+' tokens');
    }
    function updateTimerDisplay() {
      const m=Math.floor(privateShowTimeRemaining/60), s=privateShowTimeRemaining%60, d=m+':'+(s<10?'0':'')+s;
      document.getElementById('timerDisplay').textContent=d; document.getElementById('moreTimeCurrentTimer').textContent=d;
    }
    function endPrivateShow() {
      clearInterval(privateShowTimer); isInPrivateShow=false; privateShowTimeRemaining=0;
      document.getElementById('privateTimer').style.display='none'; document.getElementById('moreTimeBtn').style.display='none';
      chatHistory.unshift({type:'system',text:'‚è∞ Private show ended. Thanks!'}); renderChat(); alert('‚è∞ Private Show Ended');
    }
    function showMoreTimeOptions() {
      const s=db.getPrivateShowSettings(); const exts = s.extensions||[];
      document.getElementById('extensionOptions').innerHTML = exts.map((ext,i)=>'<div class="extension-option" onclick="addMoreTime('+i+')"><div class="flex-between"><div><div class="text-xl font-black text-violet mb-4">+'+ext.minutes+' Minutes</div><div class="text-sm text-muted">Extend your show</div></div><div style="text-align:right;"><div class="text-3xl font-black">'+ext.tokens+'</div><div class="text-xs text-muted">tokens</div></div></div></div>').join('');
      document.getElementById('moreTimeOverlay').classList.add('visible'); document.getElementById('moreTimeSheet').classList.add('open');
    }
    function addMoreTime(i) {
      const s=db.getPrivateShowSettings(); const ext=(s.extensions||[])[i]; if(!ext)return;
      if(db.getBalance()<ext.tokens){alert('Not enough tokens! '+ext.tokens+' needed.');closeMoreTimeSheet();return;}
      db.deductTokens(ext.tokens,'private-ext'); updateBalance();
      privateShowTimeRemaining+=ext.minutes*60; updateTimerDisplay(); closeMoreTimeSheet();
      chatHistory.unshift({type:'system',text:'‚è±Ô∏è +'+ext.minutes+' min added!'}); renderChat();
      alert('‚úÖ +'+ext.minutes+' minutes added!');
    }
    function joinSpyMode(){alert('üëÅÔ∏è Spy Mode\n\nNo private shows available to spy on.');closePrivateSheet();}

    // DASHBOARD
    function savePrivateSettings() {
      const s={tokensPerMin:parseInt(document.getElementById('tokensPerMin').value),minDuration:parseInt(document.getElementById('minDuration').value),extensions:[{minutes:parseInt(document.getElementById('ext1Minutes').value),tokens:parseInt(document.getElementById('ext1Tokens').value)},{minutes:parseInt(document.getElementById('ext2Minutes').value),tokens:parseInt(document.getElementById('ext2Tokens').value)},{minutes:parseInt(document.getElementById('ext3Minutes').value),tokens:parseInt(document.getElementById('ext3Tokens').value)}]};
      db.savePrivateShowSettings(s); updatePrivateShowUI(); updateDashboardPreview(); alert('‚úÖ Settings saved!');
    }
    function updatePrivateShowUI() { const s=db.getPrivateShowSettings(); const el=document.querySelector('.floating-btn-price'); if(el) el.textContent='$'+(s.tokensPerMin/10).toFixed(0)+'/min'; }
    function updateDashboardPreview() {
      const s=db.getPrivateShowSettings(); const exts=s.extensions||[];
      document.getElementById('previewPrice').textContent=(s.tokensPerMin/10).toFixed(0);
      const mc=s.tokensPerMin*s.minDuration;
      document.getElementById('previewMinCost').textContent=mc;
      document.getElementById('previewMinCostUSD').textContent=(mc/10).toFixed(0);
      // FIX #1: guard against empty/short extensions array
      if(exts[0]){document.getElementById('previewExt1Min').textContent=exts[0].minutes;document.getElementById('previewExt1Tokens').textContent=exts[0].tokens;}
      if(exts[1]){document.getElementById('previewExt2Min').textContent=exts[1].minutes;document.getElementById('previewExt2Tokens').textContent=exts[1].tokens;}
      if(exts[2]){document.getElementById('previewExt3Min').textContent=exts[2].minutes;document.getElementById('previewExt3Tokens').textContent=exts[2].tokens;}
    }
    function setupDashboardListeners() {
      ['tokensPerMin','minDuration','ext1Minutes','ext1Tokens','ext2Minutes','ext2Tokens','ext3Minutes','ext3Tokens'].forEach(id=>{
        const el=document.getElementById(id); if(el) el.addEventListener('input',()=>updateDashboardPreview());
      });
    }
    // Temporarily override updateDashboardPreview for live-edit from form values
    const _origPreview = updateDashboardPreview;
    // Actually the dashboard listeners should read from form, not db
    function setupDashboardListeners() {
      ['tokensPerMin','minDuration','ext1Minutes','ext1Tokens','ext2Minutes','ext2Tokens','ext3Minutes','ext3Tokens'].forEach(id=>{
        const el=document.getElementById(id);
        if(el) el.addEventListener('input', () => {
          const tp=parseInt(document.getElementById('tokensPerMin').value)||60;
          const md=parseInt(document.getElementById('minDuration').value)||10;
          document.getElementById('previewPrice').textContent=(tp/10).toFixed(0);
          const mc=tp*md; document.getElementById('previewMinCost').textContent=mc; document.getElementById('previewMinCostUSD').textContent=(mc/10).toFixed(0);
          document.getElementById('previewExt1Min').textContent=document.getElementById('ext1Minutes').value;
          document.getElementById('previewExt1Tokens').textContent=document.getElementById('ext1Tokens').value;
          document.getElementById('previewExt2Min').textContent=document.getElementById('ext2Minutes').value;
          document.getElementById('previewExt2Tokens').textContent=document.getElementById('ext2Tokens').value;
          document.getElementById('previewExt3Min').textContent=document.getElementById('ext3Minutes').value;
          document.getElementById('previewExt3Tokens').textContent=document.getElementById('ext3Tokens').value;
        });
      });
    }

    function renderLovenseLevelsList() {
      const levels=db.getLovenseLevels();
      document.getElementById('lovenseLevelCount').textContent=levels.length+'/5';
      document.getElementById('lovenseMaxWarning').style.display=levels.length>=5?'block':'none';
      document.getElementById('lovenseAddForm').style.display=levels.length>=5?'none':'block';
      document.getElementById('lovenseLevelsList').innerHTML=levels.map(l=>'<div class="lovense-level-item"><div style="flex:1;"><div class="text-lg font-bold mb-4">'+l.icon+' '+esc(l.label)+'</div><div class="text-sm text-muted">'+l.tokens+' tokens ‚Ä¢ '+l.duration+'s</div></div><button class="btn-delete" onclick="deleteLovenseLevel('+l.id+')">‚úï</button></div>').join('');
    }
    function addLovenseLevel() {
      const levels=db.getLovenseLevels(); if(levels.length>=5){alert('‚ö†Ô∏è Max 5!');return;}
      const icon=document.getElementById('newLovenseIcon').value, label=document.getElementById('newLovenseLabel').value.trim();
      const tokens=parseInt(document.getElementById('newLovenseTokens').value), dur=parseInt(document.getElementById('newLovenseDuration').value);
      if(!label){alert('Enter a label.');return;} if(tokens<1||tokens>1000){alert('Tokens: 1-1000');return;} if(dur<1||dur>300){alert('Duration: 1-300s');return;}
      levels.push({id:Date.now(),icon,label,tokens,duration:dur}); db.saveLovenseLevels(levels);
      document.getElementById('newLovenseLabel').value=''; document.getElementById('newLovenseTokens').value='15'; document.getElementById('newLovenseDuration').value='10';
      renderLovenseLevelsList(); alert('‚úÖ Added! '+icon+' '+label);
    }
    function deleteLovenseLevel(id) {
      const levels=db.getLovenseLevels(); const l=levels.find(x=>x.id===id); if(!l) return;
      if(confirm('Delete '+l.icon+' '+l.label+'?')){db.saveLovenseLevels(levels.filter(x=>x.id!==id));renderLovenseLevelsList();}
    }
    function renderTipButtonEditors() {
      const btns=db.getTipButtons(); const icons=['üéÅ','üíñ','üíù','üíé','üëë','üåü','‚ú®','üí∞','üî•','‚ö°','üí•','üêã','üéÜ','üéâ','üçæ','üèÜ'];
      document.getElementById('tipButtonEditors').innerHTML=btns.map((b,i)=>'<div class="config-card"><div class="text-violet font-black text-base mb-12">Button '+(i+1)+'</div><div class="form-group"><label class="form-label">Icon</label><select id="tipIcon'+i+'" onchange="updateTipPreview()" class="form-select">'+icons.map(ic=>'<option value="'+ic+'"'+(b.icon===ic?' selected':'')+'>'+ic+'</option>').join('')+'</select></div><div class="form-group"><label class="form-label">Label</label><input type="text" id="tipLabel'+i+'" value="'+esc(b.label)+'" maxlength="20" oninput="updateTipPreview()" class="form-input form-input-pink"></div><div><label class="form-label">Tokens</label><input type="number" id="tipAmount'+i+'" value="'+b.amount+'" min="1" max="10000" oninput="updateTipPreview()" class="form-input form-input-pink"></div></div>').join('');
    }
    function updateTipPreview() {
      for(let i=0;i<4;i++){const ic=document.getElementById('tipIcon'+i).value,lb=document.getElementById('tipLabel'+i).value||'Button '+(i+1),am=document.getElementById('tipAmount'+i).value||'0';const p=document.getElementById('tipPreview'+(i+1));p.querySelector('.tip-label').textContent=ic+' '+lb;p.querySelector('.tip-amount').textContent='ü™ô '+am;}
    }
    function saveTipButtons() {
      for(let i=0;i<4;i++){if(!document.getElementById('tipLabel'+i).value.trim()){alert('Button '+(i+1)+' needs a label!');return;}const a=parseInt(document.getElementById('tipAmount'+i).value);if(a<1||a>10000){alert('Button '+(i+1)+': tokens 1-10,000');return;}}
      const nb=[]; for(let i=0;i<4;i++) nb.push({icon:document.getElementById('tipIcon'+i).value,label:document.getElementById('tipLabel'+i).value.trim(),amount:parseInt(document.getElementById('tipAmount'+i).value)});
      db.saveTipButtons(nb); alert('‚úÖ Tip buttons saved!');
    }
    function renderOnlineSchedule() {
      const list=document.getElementById('onlineScheduleList'), sched=db.getOnlineSchedule();
      if(!sched.length){list.innerHTML='<div class="empty-state">No online hours set</div>';return;}
      list.innerHTML=sched.map(s=>'<div class="schedule-item schedule-item-online"><div><div class="text-base font-bold mb-4">'+esc(s.day)+'</div><div class="text-sm text-gold">'+s.startTime+' - '+s.endTime+'</div></div><button class="btn-delete-sm" onclick="deleteOnlineSchedule('+s.id+')">‚úï</button></div>').join('');
    }
    function renderLiveSchedule() {
      const list=document.getElementById('liveScheduleList'), sched=db.getLiveSchedule();
      if(!sched.length){list.innerHTML='<div class="empty-state">No live hours set</div>';return;}
      list.innerHTML=sched.map(s=>'<div class="schedule-item schedule-item-live"><div><div class="text-base font-bold mb-4">'+esc(s.day)+'</div><div class="text-sm text-red">'+s.startTime+' - '+s.endTime+'</div></div><button class="btn-delete-sm" onclick="deleteLiveSchedule('+s.id+')">‚úï</button></div>').join('');
    }
    function addSchedule(type) {
      const days=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
      const d=prompt('Day (1-7):\n'+days.map((d,i)=>(i+1)+'. '+d).join('\n'));
      if(!d||d<1||d>7)return; const dn=days[parseInt(d)-1];
      const st=prompt('Start (HH:MM):\ne.g. 18:00'); if(!st||!/^\d{2}:\d{2}$/.test(st)){alert('Use HH:MM');return;}
      const en=prompt('End (HH:MM):\ne.g. 23:00'); if(!en||!/^\d{2}:\d{2}$/.test(en)){alert('Use HH:MM');return;}
      const sched=type==='online'?db.getOnlineSchedule():db.getLiveSchedule();
      sched.push({id:Date.now(),day:dn,startTime:st,endTime:en});
      type==='online'?db.saveOnlineSchedule(sched):db.saveLiveSchedule(sched);
      type==='online'?renderOnlineSchedule():renderLiveSchedule();
      alert('‚úÖ '+dn+' '+st+'-'+en);
    }
    function addOnlineSchedule(){addSchedule('online');} function addLiveSchedule(){addSchedule('live');}
    function deleteOnlineSchedule(id){const s=db.getOnlineSchedule(),sl=s.find(x=>x.id===id);if(!sl)return;if(confirm('Delete '+sl.day+'?')){db.saveOnlineSchedule(s.filter(x=>x.id!==id));renderOnlineSchedule();}}
    function deleteLiveSchedule(id){const s=db.getLiveSchedule(),sl=s.find(x=>x.id===id);if(!sl)return;if(confirm('Delete '+sl.day+'?')){db.saveLiveSchedule(s.filter(x=>x.id!==id));renderLiveSchedule();}}

    // PROFILE
    function openProfile(name,avatar,color,club,state) {
      currentProfile={name,avatar,color,club,state};
      document.getElementById('profileAvatar').innerHTML=avatar; document.getElementById('profileAvatar').style.background=color;
      document.getElementById('profileName').textContent=name;
      document.getElementById('profileVenue').textContent='üõ°Ô∏è Verified at '+(club||'Venue')+', '+(STATE_NAMES[state]||state||'');
      const on=db.getOnlineSchedule(); document.getElementById('profileOnlineSchedule').innerHTML=on.length?on.map(s=>'<div class="profile-schedule-item profile-schedule-online"><span class="text-md font-bold">'+esc(s.day)+'</span><span class="text-sm text-gold">'+s.startTime+' - '+s.endTime+'</span></div>').join(''):'<div class="text-dim text-md">No hours set</div>';
      const lv=db.getLiveSchedule(); document.getElementById('profileLiveSchedule').innerHTML=lv.length?lv.map(s=>'<div class="profile-schedule-item profile-schedule-live"><span class="text-md font-bold">'+esc(s.day)+'</span><span class="text-sm text-red">'+s.startTime+' - '+s.endTime+'</span></div>').join(''):'<div class="text-dim text-md">No hours set</div>';
      showPage('profile');
    }
    function bookPrivateShow(){alert('üìÖ Book Private Show\n\n'+currentProfile.name+'\n\nComing soon!');}
    function sendMessage(){alert('üíå Send Message\n\n'+currentProfile.name+'\n\nComing soon!');}

    // INIT
    initBrowse(); renderPackages(); updateBalance(); setupDashboardListeners();
    renderLovenseLevelsList(); renderTipButtonEditors(); renderOnlineSchedule(); renderLiveSchedule(); updatePrivateShowUI();
    (function loadSettings(){
      const ps=db.getPrivateShowSettings(), exts=ps.extensions||[];
      const el=id=>document.getElementById(id);
      if(el('tokensPerMin')) el('tokensPerMin').value=ps.tokensPerMin;
      if(el('minDuration')) el('minDuration').value=ps.minDuration;
      if(exts[0]){if(el('ext1Minutes'))el('ext1Minutes').value=exts[0].minutes;if(el('ext1Tokens'))el('ext1Tokens').value=exts[0].tokens;}
      if(exts[1]){if(el('ext2Minutes'))el('ext2Minutes').value=exts[1].minutes;if(el('ext2Tokens'))el('ext2Tokens').value=exts[1].tokens;}
      if(exts[2]){if(el('ext3Minutes'))el('ext3Minutes').value=exts[2].minutes;if(el('ext3Tokens'))el('ext3Tokens').value=exts[2].tokens;}
      updateDashboardPreview();
    })();
    // FIX #7: only update counts, not full re-render, every 30s
    setInterval(()=>{
      Object.keys(CLUBS).forEach(s=>{const n=CLUBS[s].length;counts[s]={live:Math.floor(Math.random()*Math.min(n,8)),offline:Math.floor(Math.random()*Math.min(n*2,15))};});
      streamerCache={}; // clear cache so new counts apply
      updateBrowseStats();
      renderStateGrid(); // lighter re-render at 30s vs 15s
      renderTrending();
    }, 30000);

  </script>
</body>
</html>